/*
 * Wallaby.js - v1.0.634
 * http://wallabyjs.com
 * Copyright (c) 2014-2018 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
var path=require("path"),vm=require("vm"),Module=require("module"),tracer=global.$_$tracer,utils=tracer._utils,file,entryModule,quokkaSettings={},quokkaSettingsNodeModulesPath,quokkaTempDirNodeModulesPath,beforeExitHandlers=[],startTime,serverPath=path.dirname(process.mainModule.filename);tracer._maxLogEntrySize=1048576,tracer._hiddenGlobalProps={$_$baseDir:1,$_$slow:1,$_$testFiles:1,$_$tests:1,$_$session:1,$_$initialSpecId:1,$_$coverage:1},process.on("unhandledRejection",function(e){throw e});try{quokkaSettings=JSON.parse(process.env.quokka),quokkaSettingsNodeModulesPath=path.join(path.dirname(quokkaSettings.globalConfigFile),"node_modules"),quokkaTempDirNodeModulesPath=path.join(quokkaSettings.tempDir,"node_modules")}catch(e){}var requireFromTheProjectAndGlobalSettingsContext=function(e){var t=Module._load(e,entryModule,!1);try{var n=Module._resolveFilename(e,entryModule,!1);tracer._doWhenReceiverIsReady(function(){tracer._send("module",{path:n})})}catch(i){}return t};requireFromTheProjectAndGlobalSettingsContext.extensions=require.extensions,requireFromTheProjectAndGlobalSettingsContext.resolve=require.resolve;var localProjectRoot=path.dirname(global.wallaby._localNodeModules),rootEntryModule=new Module(".",null);rootEntryModule.filename=path.join(localProjectRoot,"index.js"),rootEntryModule.paths=Module._nodeModulePaths(localProjectRoot).concat([quokkaSettingsNodeModulesPath]);var requireFromTheProjectRootAndGlobalSettingsContext=function(e){return Module._load(e,rootEntryModule,!1)};requireFromTheProjectRootAndGlobalSettingsContext.extensions=require.extensions,requireFromTheProjectRootAndGlobalSettingsContext.resolve=require.resolve;var hideProp=function(e){Object.defineProperty(global,e,{enumerable:!1,value:global[e]})};Object.keys(global).filter(function(e){return"wallaby"===e||0===e.indexOf("$_$")}).forEach(function(e){hideProp(e)}),require.extensions[".jsx"]=require.extensions[".js"],[".png",".svg",".ico","jpeg",".jpg",".css",".less",".scss",".sass",".htm",".html"].forEach(function(e){require.extensions[e]=function(){}});var identifierExpressionAutoLogHitLimit=10;global.$_$wv=function(e,t,n,i,o,a,r){var l=tracer._autoConsoleHits[n]=tracer._autoConsoleHits[n]||0;return!r||identifierExpressionAutoLogHitLimit>l?tracer._doWhenReceiverIsReady(function(){tracer._autoLogValue(e,t,l,i,o,a,r)},arguments):l===identifierExpressionAutoLogHitLimit&&tracer._doWhenReceiverIsReady(function(){tracer._sendLog("log","Only the first "+identifierExpressionAutoLogHitLimit+" values are automatically logged, use console.log("+(i||"...")+") for the full output",i,e,t)},arguments),tracer._autoConsoleHits[n]=l+1,o};var delayedSendTimeout,delayedSendTimeoutDelay=50,clearDelayedSendTimeout=function(){clearTimeout(delayedSendTimeout),delayedSendTimeout=void 0},delayedSendCalls=[],send=tracer._send;tracer._send=function(e,t){var n=this,i=function(){return send.call(n,e,t)};if(n._receiver)return i();if(delayedSendCalls.push(i),!delayedSendTimeout){var o=global.$_$session;delayedSendTimeout=setTimeout(function(){o===global.$_$session&&tracer&&tracer.reconnect(function(){for(var e=0;e<delayedSendCalls.length;e++)delayedSendCalls[e]();delayedSendCalls.length=0,clearDelayedSendTimeout(),tracer.disconnect()})},delayedSendTimeoutDelay)}};var toInitialize={babel:!0,ts:!0,plugins:!0,globals:["assert","events","fs","os","path"]},runBeforeEach=[],starter={quokkaStackTraceMarker:function(){clearDelayedSendTimeout();var e=global.$_$session;if(quokkaSettings.babel&&toInitialize.babel){var t={ignore:"string"==typeof quokkaSettings.babel.ignore?new RegExp(quokkaSettings.babel.ignore):function(e){return~e.indexOf("quokka.js")||~e.indexOf("node_modules")},presets:quokkaSettings.babel.presets,plugins:quokkaSettings.babel.plugins},n=NaN;if(quokkaSettings.babel.version&&(n=parseInt(quokkaSettings.babel.version.split(".")[0],10)),n>=7){utils.patchBabelResolve(quokkaSettings.babel.path);try{delete t.ignore,require(path.join(path.dirname(quokkaSettings.babel.path),"register"))(t)}catch(i){console.warn("@babel/register is not installed, the module is required if you want to transpile other files imported by the running file")}}else require(path.join(quokkaSettings.babel.path,"register"))(t);quokkaSettings.babel.polyfill&&require(path.join(path.dirname(quokkaSettings.babel.path),"babel-polyfill")),delete toInitialize.babel}if(quokkaSettings.ts&&toInitialize.ts){if(quokkaSettings.ts.tsNode){var o=quokkaSettings.ts.tsNode.ignore||["/node_modules/"];o=Array.isArray(o)?o:[o],o.push(serverPath),require(path.join(quokkaSettings.ts.tsNode.path)).register({compiler:process.env.TS_NODE_COMPILER,ignore:o});try{require(path.join(path.dirname(quokkaSettings.ts.tsNode.path),"tsconfig-paths/register"))}catch(i){}}else require.extensions[".ts"]=require.extensions[".tsx"]=function(){throw new Error("To import TypeScript files from quokka, `ts-node` module must be installed")};delete toInitialize.ts}quokkaSettings.plugins&&toInitialize.plugins&&("string"==typeof quokkaSettings.plugins&&(quokkaSettings.plugins=[quokkaSettings.plugins]),quokkaSettings.plugins.slice().forEach(function(e){var t=requireFromTheProjectRootAndGlobalSettingsContext(e);t.before&&t.before(quokkaSettings),t.beforeEach&&runBeforeEach.push(t.beforeEach)}),delete toInitialize.plugins),toInitialize.globals&&(toInitialize.globals.forEach(function(e){global[e]||(global[e]=require(e))}),delete toInitialize.globals),runBeforeEach.forEach(function(e){e(quokkaSettings)});var a=function(){if(e===global.$_$session&&tracer){var t;if(startTime){var n=process.hrtime(startTime);t=(1e3*n[0]+n[1]/1e6).toFixed(2)}clearDelayedSendTimeout(),tracer.reconnect(function(){for(var e=0;e<delayedSendCalls.length;e++)delayedSendCalls[e]();delayedSendCalls.length=0,tracer.complete({time:t}),clearDelayedSendTimeout()})}};process.once("beforeExit",a),beforeExitHandlers.push(a);var r={quokkaStackTraceMarker:function(){startTime=process.hrtime(),entryModule._compile(file.content,file.path)}};try{r.quokkaStackTraceMarker()}finally{tracer.disconnect()}}};tracer.start(starter.quokkaStackTraceMarker),module.exports={init:function(e){return file={path:e[0],content:global.$_$testFiles[0].content},entryModule=new Module(".",null),entryModule.filename=file.path,entryModule.paths=Module._nodeModulePaths(path.dirname(entryModule.filename)).concat([quokkaTempDirNodeModulesPath,quokkaSettingsNodeModulesPath]),entryModule.require=requireFromTheProjectAndGlobalSettingsContext,beforeExitHandlers.forEach(function(e){process.removeListener("beforeExit",e)}),beforeExitHandlers.length=0,Object.keys(tracer._hiddenGlobalProps).forEach(function(e){hideProp(e)}),{}}};