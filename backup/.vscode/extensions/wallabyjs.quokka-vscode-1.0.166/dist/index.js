/*
 * quokka-vscode - v1.0.166
 * Copyright (c) 2017-2018 WallabyJs - All Rights Reserved.
 */

!function a(r,u,c){process.env.WALLABY_PRODUCTION=!0;var l="function"==typeof require&&require;module.exports=function i(n,e){if(!u[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var s=u[n]={exports:{}};r[n][0].call(s.exports,function(e){var t=r[n][1][e];return i(t||e)},s,s.exports,a,r,u,c)}return u[n].exports}(c[0])}({1:[function(u,e,t){"use strict";var i=this&&this.__awaiter||function(s,a,r,u){return new(r||(r=Promise))(function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,n)}o((u=u.apply(s,a||[])).next())})},c=this&&this.__generator||function(i,n){var o,s,a,e,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,s=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(a=0<(a=r.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){r.label=t[1];break}if(6===t[0]&&r.label<a[1]){r.label=a[1],a=t;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(t);break}a[2]&&r.ops.pop(),r.trys.pop();continue}t=n.call(i,r)}catch(e){t=[6,e],s=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},r=u("fs"),l=u("path"),p=u("vscode"),h=u("vsls/vscode"),d=u("./lib/compositeDisposable"),n=p.window,f="quokkajs",_=function(){function r(){}return r.prototype.activate=function(a){return i(this,void 0,void 0,function(){var t,i,n,o,s;return c(this,function(e){switch(e.label){case 0:return(t=this)._disposables=new d,t._setupStatusIndicator(),i=u(a.globalState.get("corePath")),n={context:a,coreClient:i,statusBar:t._statusBar,deactivate:function(){return t.deactivate()},version:r._getVersion()},[4,h.getApiAsync()];case 1:return o=e.sent(),s=u("./lib/controller"),t._controller=new s(n,o,f),t._controller.activate(),t._disposables.add(function(){return t._controller.deactivate()}),t._disposables.add(function(){return o.unshareService(f)}),[2]}})})},r._getVersion=function(){var e=1,t=0;try{var i=p.version.split(".");e=parseInt(i[0],10),t=parseInt(i[1],10)}catch(e){}return{major:e,minor:t}},r.prototype._setupStatusIndicator=function(){var i=this;i._statusBar=n.createStatusBarItem(p.StatusBarAlignment.Right,Number.NEGATIVE_INFINITY),i._statusBar.show();var e=i._statusBar.hide.bind(i._statusBar),t=i._statusBar.dispose.bind(i._statusBar);i._statusBar.hide=function(){i._statusBar.stopProgress(),i._statusBar._mainText="",i._statusBar._extensionText="",i._statusBar.updateText(),e()},i._statusBar.dispose=function(){i._statusBar.stopProgress(),t()},i._statusBar.displayProgress=function(){var e=0,t=["[=-----]","[-=----]","[--=---]","[---=--]","[----=-]","[-----=]","[----=-]","[---=--]","[--=---]","[-=----]"];clearInterval(i._statusBar._progress),i._statusBar._progress=setInterval(function(){i._statusBar.setMainText(t[e=++e%t.length]+"   "),i._statusBar._doUpdateText()},150)},i._statusBar.setMainText=function(e){i._statusBar._mainText=e},i._statusBar.setExtensionText=function(e){i._statusBar._extensionText=e},i._statusBar.updateText=function(){return i._statusBar._doUpdateText()},i._statusBar._doUpdateText=function(){i._statusBar.text=(i._statusBar._mainText||"")+" "+(i._statusBar._extensionText||"")},i._statusBar.stopProgress=function(){clearInterval(i._statusBar._progress),delete i._statusBar._progress},i._statusUpdater=function(e){i._statusBar.tooltip=e},i._disposables.add(function(){i._removeStatusIndicator()})},r.prototype._hideStatusIndicator=function(){this._statusBar&&(this._statusBar.text="",this._statusBar.tooltip="",this._statusBar.hide()),this._statusUpdater=function(){}},r.prototype._removeStatusIndicator=function(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=function(){}},r.prototype.deactivate=function(){this._disposables.dispose()},r}();t.activate=function(n){var e=new _;n.subscriptions.push({dispose:function(){return e.deactivate()}});var t=_._getVersion();if(t.major<=1&&t.minor<18){var i=process.exit,o=process.exit=function(){(function(){e.deactivate(),i.apply(process,arguments)}).apply(null,arguments)};process.on("SIGINT",function(){o.apply(null,arguments)}),process.on("SIGTERM",function(){o.apply(null,arguments)}),process.on("exit",function(){o.apply(null,arguments)})}try{var s=p.workspace.getConfiguration();if(s){var a=s.get("quokka.colors",{});a&&Object.keys(a).forEach(function(t){try{if(!t)return;var e=n.asAbsolutePath(l.join("images",t+".svg"));if(!r.existsSync(e))return;var i=r.readFileSync(e).toString().replace(/fill:#.[^;]*/,"fill:"+a[t]);r.writeFileSync(e,i)}catch(e){console.error("Failed to set icon "+t+" type to "+a[t]+". "+e.message)}})}}catch(e){}e.activate(n)}},{"./lib/compositeDisposable":4,"./lib/controller":5,fs:void 0,path:void 0,vscode:void 0,"vsls/vscode":void 0}],2:[function(i,e,t){"use strict";var n=i("vscode"),o=i("path");t.activate=function(e){var t=n.workspace.getConfiguration()&&n.workspace.getConfiguration().get("quokka.debug",!1);t?(global.originalRequire=i,e.globalState.update("corePath","../../wallaby/client")):e.globalState.update("corePath","./wallaby/client"),t?i("./out/extension").activate(e):"dist"===o.basename(__dirname)?i("./extension").activate(e):(global.originalRequire=i)("./dist/index").activate(e)}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("path"),o=e("fs"),s=e("os"),a=e("vscode"),r=function(){function e(e,t){this.disposable=void 0,this.disposed=!1,this.start=e||new Date(Date.UTC(2018,10,21,0,0,0,0)),this.end=t||new Date(Date.UTC(2018,10,28,0,0,0,0)),this.config=n.join(s.homedir(),".quokka","state.json"),this.nextCheckTime=void 0}return e.prototype.setup=function(){var e=this;new Date>this.end?this.deleteStateConfig():(this.nextCheckTime=this.getNextCheckTime()||this.start,this.nextCheckTime<this.end&&(this.checkAndShowMessage(),this.disposable=a.window.onDidChangeActiveTextEditor(function(){e.checkAndShowMessage()})))},e.prototype.checkAndShowMessage=function(){var e=new Date;!this.disposed&&e>this.start&&e<this.end&&this.nextCheckTime&&e>=this.nextCheckTime&&(this.nextCheckTime=this.setNextCheckTime(),this.showMessageAndHandleUserResponse())},e.prototype.showMessageAndHandleUserResponse=function(){var t=this;try{a.window.showInformationMessage("Get Quokka.js PRO today with our limited time 50% Black Friday discount!",{title:"Buy License",url:a.Uri.parse("https://quokkajs.com/pro/#personal-pro")},{title:"Read More",url:a.Uri.parse("https://quokkajs.com/pro")},{title:"Do not show again",dontShow:!0}).then(function(e){return t.handleUserResponse(e)})}catch(e){}},e.prototype.handleUserResponse=function(e){e&&(e.dontShow?(this.setNextCheckTimeToEndDate(),this.dispose()):e.url&&a.commands.executeCommand("vscode.open",e.url))},e.prototype.setNextCheckTimeToEndDate=function(){try{this.nextCheckTime=this.end,o.writeFileSync(this.config,JSON.stringify({nextCheck:this.end}))}catch(e){}},e.prototype.deleteStateConfig=function(){try{o.existsSync(this.config)&&o.unlinkSync(this.config)}catch(e){}},e.prototype.dispose=function(){this.disposable&&this.disposable.dispose(),this.disposed=!0},e.prototype.setNextCheckTime=function(){var e=new Date,t=new Date(e.setDate(e.getDate()+1));try{o.writeFileSync(this.config,JSON.stringify({nextCheck:t}))}catch(e){}return t},e.prototype.getNextCheckTime=function(){try{if(o.existsSync(this.config)){var e=o.readFileSync(this.config).toString(),t=JSON.parse(e);return new Date(t.nextCheck)}return}catch(e){this.deleteStateConfig()}},e}();i.SalesEvent=r},{fs:void 0,os:void 0,path:void 0,vscode:void 0}],4:[function(e,t,i){"use strict";var n=function(){function e(){this._disposables=[]}return e.prototype.add=function(e){e.dispose?this._disposables.push(e):this._disposables.push({dispose:e})},e.prototype.dispose=function(){this._disposables.forEach(function(e){return e.dispose()})},e}();t.exports=n},{}],5:[function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),l=this&&this.__awaiter||function(s,a,r,u){return new(r||(r=Promise))(function(e,t){function i(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,n)}o((u=u.apply(s,a||[])).next())})},p=this&&this.__generator||function(i,n){var o,s,a,e,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,s=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(a=0<(a=r.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){r.label=t[1];break}if(6===t[0]&&r.label<a[1]){r.label=a[1],a=t;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(t);break}a[2]&&r.ops.pop(),r.trys.pop();continue}t=n.call(i,r)}catch(e){t=[6,e],s=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},d=e("path"),c=e("fs"),a=e("os"),f=e("vscode"),_=global._,r=e("./SalesEvent"),s=global.EventEmitter,u=e("./valueExplorer"),v=e("./compositeDisposable"),m=e("./outputBuilder"),g=f.workspace,k=f.window,y=["showOutput","createFile","makeQuokkaFromExistingFile","runOnSave","runOnce","createJavaScriptFile","createTypeScriptFile","showInstrumentedFile","stopCurrent","stopAll","installMissingPackageToProject","installMissingPackageToQuokka","installQuokkaPlugin","goToLineInQuokkaFile","showLicense","switchToPro","switchToCommunity","selectWorkspaceFolder","addImport","addRequire","showValue","copyExpressionPath","copyExpressionData"],S={javascript:".js",javascriptreact:".js",plaintext:".js",typescript:".ts",typescriptreact:".tsx"},x=0,C=1,w=2,h=function(s){function h(e,t,i){var n=s.call(this)||this,o=n;return n._state=e,n._context=e.context,n._statusBar=e.statusBar,n._deactivator=e.deactivate,n._Session=e.coreClient.Session,n._utils=e.coreClient.utils,n._outputDocumentSelector={language:"wallaby-output"},n._setupVersionSpecificComponents(e.version),n._disposables=new v,_.each(y,function(t){return o._disposables.add(f.commands.registerCommand("quokka."+t,function(e){try{return o[t](e)}catch(e){console.error(e)}}))}),f.commands.executeCommand("setContext","quokka.isLiveShareClient",!1),n._coverageDecorationTypes={1:o._createCoverageDecorationType("notCovered"),2:o._createCoverageDecorationType("covered"),3:o._createCoverageDecorationType("partiallyCovered"),4:o._createCoverageDecorationType("errorSource"),5:o._createCoverageDecorationType("errorPath")},n._hideAfterContentDecorationType=k.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 -10000px"}}),n._debugOutputChannel={appendLine:function(e,t){console.log("%c "+e,"color: "+("error"===t?"red":"darkgreen"))}},n._activeSessions=[],n._activeSession=null,n.outputChannel=k.createOutputChannel("Quokka"),n.outputChannel.append(""),k.onDidChangeActiveTextEditor(function(t){if(t){var e=n._activeSessions.find(function(e){return t.document===e.textDocument});e&&n._checkAndSyncSession(e)}}),n._setupEnvironment(),n._setupLiveSharing(t,i),f.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),n._valueExplorer=new u(n._context),n.on("started",function(){n._liveShareClientActive()||f.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!0)}),n}return o(h,s),h.prototype._setupLiveSharing=function(u,c){return l(this,void 0,void 0,function(){var t,i,n,o,s,a,r=this;return p(this,function(e){switch(e.label){case 0:return u?[3,1]:(this._debugOutputChannel.appendLine("Quokka.js Live Share integration disabled, VSLS not found."),[2]);case 1:return this._liveShare={api:u},t=this._liveShare,[4,u.shareService(c)];case 2:return t.server=e.sent(),i=this._liveShare,[4,u.getSharedService(c)];case 3:if(i.client=e.sent(),!this._liveShare.server||!this._liveShare.client)return this._debugOutputChannel.appendLine('Could not create a shared service. You have to set "liveshare.features" to "experimental" in your user settings in order to use live sharing.'),delete this._liveShare,[2];e.label=4;case 4:return n=function(){return _.uniq(r._activeSessions.map(function(e){return{file:e.liveShareFileName,originalFile:e.textDocument.uri,fileName:e.fileName,documentUpdates:e.documentUpdates,stats:e.stats,mode:e.mode,headerData:e.headerData,liveConsoleOutput:e.allLiveConsoleOutput,status:e.status}}))},o=function(t){var i=r._liveShare.activeServerSessions.find(function(e){return 0===t.document.uri.scheme.localeCompare(e.file.scheme)&&0===t.document.uri.path.localeCompare(e.file.path)});if(i){r._start(t.document,t,i.mode);var e=a(i.file);r.processStarted(e),e.output.setHeaderData(i.headerData),e.headerData=i.headerData,i.documentUpdates[i.file.path]=i.documentUpdates[i.fileName],delete i.documentUpdates[i.fileName],r._updateDocuments(e,i.documentUpdates),e.stats=i.stats,e.status=i.status,r.processStats(e),e.liveConsoleOutput=i.liveConsoleOutput,e.liveConsoleOutput&&e.liveConsoleOutput.length&&r._displayLiveConsoleOutput(e,e.liveConsoleOutput),r._liveShare.activeServerSessions=r._liveShare.activeServerSessions.filter(function(e){return e!=i})}},this._liveShare.api.onDidChangePeers(function(t){return l(r,void 0,void 0,function(){return p(this,function(e){return this._liveShareServerActive()&&t.added.length&&(this._liveShare.serverAllowed||this._activeSessions.length&&(k.showWarningMessage("You have not given permission to run Quokka.js in your Live Share Session. All Quokka.js instances have been stopped."),this.stopAll())),[2]})})}),this._context.subscriptions.push(this._liveShare.server.onDidChangeIsServiceAvailable(function(i){return l(r,void 0,void 0,function(){var t=this;return p(this,function(e){return i?(this._activeSessions.forEach(function(e){e.liveShareFileName=t._liveShare.api.convertLocalUriToShared(e.textDocument.uri)}),this._liveShare.disposable=new v,this._liveShare.disposable.add(function(){return delete t._liveShare.serverAllowed}),this._liveShare.serverAllowed=!1,this._activeSessions.length&&this._showLiveShareWarningMessage()):(this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable),[2]})})})),this._context.subscriptions.push(this._liveShare.client.onDidChangeIsServiceAvailable(function(n){return l(r,void 0,void 0,function(){var t,i=this;return p(this,function(e){switch(e.label){case 0:return n?(f.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),f.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),this._liveShare.disposable=new v,this._liveShare.disposable.add(function(){return delete i._liveShare.activeServerSessions}),this._liveShare.disposable.add(k.onDidChangeActiveTextEditor(function(e){return o(e)})),t=this._liveShare,[4,this._liveShare.client.request("init",[])]):[3,2];case 1:return t.activeServerSessions=e.sent(),[3,3];case 2:f.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable,e.label=3;case 3:return[2]}})})})),s=function(t){return k.visibleTextEditors.find(function(e){return 0===e.document.uri.scheme.localeCompare(t.scheme)&&0===e.document.uri.path.localeCompare(t.path)})},a=function(t){return r._activeSessions.find(function(e){return e.fileName===t.path})},this._liveShare.server.onRequest("init",function(){return n()}),this._liveShare.client.onNotify("busy",function(e){var t=a(e.file);t&&r.processSessionBusy(t)}),this._liveShare.client.onNotify("stopped",function(t){var i=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});i&&r._liveShare.activeServerSessions.filter(function(e){return e!=i});var e=a(t.file);e&&(r._stop(e),r._hideStatusIndicator())}),this._liveShare.client.onNotify("started",function(t){var e=s(t.file);if(e){r._start(e.document,e,t.data.mode);var i=a(t.file);r.processStarted(i)}else{r._liveShare.activeServerSessions.find(function(e){return 0===t.file.uri.scheme.localeCompare(e.file.scheme)&&0===t.file.uri.path.localeCompare(e.file.path)})||r._liveShare.activeServerSessions.push({file:t.file,originalFile:t.originalFile,fileName:t.fileName,documentUpdates:{},stats:void 0,status:void 0,mode:t.data.mode,headerData:null})}}),this._liveShare.client.onNotify("stats",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.stats=t.data,delete e.status,delete e.liveConsoleOutput,delete e.allLiveConsoleOutput);var i=a(t.file);i&&(i.stats=t.data,delete i.status,delete i.liveConsoleOutput,delete i.allLiveConsoleOutput,r.processStats(i))}),this._liveShare.client.onNotify("documentUpdates",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.documentUpdates=t.data);var i=a(t.file);i&&(t.data[t.file.path]=t.data[t.fileName],delete t.data[t.fileName],r._updateDocuments(i,t.data))}),this._liveShare.client.onNotify("consoleOutput",function(e){var t=a(e.file);t&&r._displayLiveConsoleOutput(t,e.data)}),this._liveShare.client.onNotify("configChanged",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return 0===t.file.scheme.localeCompare(e.file.scheme)&&0===t.file.path.localeCompare(e.file.path)});e&&(e.headerData=t.data);var i=a(t.file);i&&(i.output.setHeaderData(t.data),i.headerData=t.data)}),[2]}})})},h.prototype._setupEnvironment=function(){var t=this;this._quokkaFolder=d.join(a.homedir(),".quokka"),this._lkp=d.join(this._quokkaFolder,".qlc");try{c.existsSync(this._quokkaFolder)||c.mkdirSync(this._quokkaFolder)}catch(e){}var i=this._loadQuokkaConfig();this._pro=!0===i.pro,!0!==this._pro?(this._salesEvent=new r.SalesEvent,this._salesEvent.setup()):(new r.SalesEvent).deleteStateConfig(),!0!==i.pro&&!1!==i.pro&&(k.showInformationMessage("Would you like to try 'Pro' edition features or to only use the 'Community' edition features?",{title:"'Pro' features as well",pro:!0},{title:"'Community' features only",pro:!1}).then(function(e){e&&(i.pro=e.pro,t._saveQuokkaConfig(i))}),k.showInformationMessage("You are using Quokka.js 'Community' edition (free). Quokka.js 'Pro' edition with some advanced features is also available.",{title:"More info",url:f.Uri.parse("https://quokkajs.com/pro")}).then(function(e){e&&e.url&&f.commands.executeCommand("vscode.open",e.url)}))},h.prototype._quokkaConfigPath=function(){return d.join(this._quokkaFolder,"config.json")},h.prototype._loadQuokkaConfig=function(){var t,e=this._quokkaConfigPath(),i={};try{t=c.readFileSync(e).toString(),i=JSON.parse(t)}catch(e){t&&k.showWarningMessage("Looks like your quokka config.json file has invalid syntax, it should be a valid JSON file.")}return i},h.prototype._saveQuokkaConfig=function(e){c.writeFileSync(this._quokkaConfigPath(),JSON.stringify(e))},h.prototype._createCoverageDecorationType=function(e){return k.createTextEditorDecorationType({isWholeLine:!0,gutterIconPath:this._context.asAbsolutePath(d.join("images",e+".svg")).split("\\").join("/"),light:{after:{color:"errorSource"===e?"#c80000":"#0000ff"}},dark:{after:{color:"errorSource"===e?"#fe536a":"rgba(86, 156, 214, 1)"}}})},h.prototype.addImport=function(e){k.activeTextEditor&&h._addCode(k.activeTextEditor,"import "+e+" from '"+e+"';\n")},h.prototype.addRequire=function(e){k.activeTextEditor&&h._addCode(k.activeTextEditor,"const "+e+" = require('"+e+"');\n")},h._addCode=function(e,t){var i=new f.WorkspaceEdit;i.insert(e.document.uri,new f.Position(0,0),t),f.workspace.applyEdit(i)},h.prototype.createFile=function(){var t=this;k.showQuickPick(["JavaScript","TypeScript"]).then(function(e){return t._createLanguageFile(e)})},h.prototype.showOutput=function(){this._activeSession&&this.outputChannel&&this.outputChannel.show(!0)},h.prototype.createJavaScriptFile=function(){this._createLanguageFile("JavaScript")},h.prototype.createTypeScriptFile=function(){this._createLanguageFile("TypeScript")},h.prototype.makeQuokkaFromExistingFile=function(){var e=this;this._runIfAllowed(function(){return e._runFromExistingFile(x)})},h.prototype.runOnSave=function(){var e=this;this._pro?this._runIfAllowed(function(){return e._runFromExistingFile(C)}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},h.prototype.runOnce=function(){var n=this;this._pro?this._runIfAllowed(function(){var e=k.activeTextEditor;if(e){var t=e.document;if(t){var i=n._activeSessions.find(function(e){return e.textDocument===t});i&&i.mode===w?i.changes.length?n._processDocumentContentChange(i,t,[],!0):i.runTests({file:i.fileName}):n._runFromExistingFile(w)}}}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},h.prototype.stopCurrent=function(){var t=k.activeTextEditor,e=t&&t.document&&this._activeSessions.find(function(e){return e.textDocument===t.document})||this._activeSession;e&&this._stop(e)},h.prototype.stopAll=function(){var t=this;this._activeSessions.slice().forEach(function(e){return t._stop(e)})},h.prototype.showInstrumentedFile=function(){var t=this;this._activeSession&&this._activeSession.requestInstrumentedFile({path:this._activeSession.fileName},function(e){t._activeSession.output.clearAndRenderHeader(),t._activeSession.output.appendConsoleMessage({text:e,type:"warn"})})},h.prototype.installMissingPackageToProject=function(){this._installPackage(!0)},h.prototype.installMissingPackageToQuokka=function(){this._installPackage()},h.prototype.installQuokkaPlugin=function(e){this._installPackage(!1,e)},h.prototype.showValue=function(){var e=k.activeTextEditor;if(e){var t=this._activeSession;if(t&&t.textDocument&&e.document===t.textDocument){var i=e.selection;if(i&&i.end){var n=t.textDocument.offsetAt(i.end),o=t.textDocument.getText();t.fileChangedInEditor(t.fileName,o.substring(0,n)+"/*?*/"+o.substr(n),void 0,!0)}}}},h.prototype.copyExpressionPath=function(e){e&&e.copyExpressionPath()},h.prototype.copyExpressionData=function(e){e&&e.copyExpressionData()},h.prototype.goToLineInQuokkaFile=function(e){if(this._activeSession)if(e){var i=(e=e.split(","))[0]-1,n=(e[1]||1)-1;k.showTextDocument(this._activeSession.textDocument).then(function(e){var t=new f.Position(i,n);e.revealRange(new f.Range(t,t)),e.selection=new f.Selection(t,t)})}else k.showTextDocument(this._activeSession.textDocument)},h.prototype._installPackage=function(e,t){if(this._activeSession)if(t)this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:t,plugin:{editConfig:!0}}});else{if(e&&!this._projectRoot())return void k.showWarningMessage("Cannot install a package into project because quokka is running outside of an opened project.");if(!this._pro)return void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession);if(!this._activeSession.stats||!this._activeSession.stats.errors)return void k.showWarningMessage("No missing packages to install.");var i=_.find(this._activeSession.stats.errors,function(e){return e.missingPackage});if(!i||!i.missingPackage)return void k.showWarningMessage("No missing packages to install.");this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:i.missingPackage,local:e}})}else k.showWarningMessage("Cannot install a package because quokka is not running.")},h.prototype._setupVersionSpecificComponents=function(e){var t=e.major,i=e.minor;1<=t&&11<=i&&(this._outputDocumentSelector.scheme="*"),1<=t&&16<=i&&(this._multiFolderWorkspaces=!0)},h.prototype._createLanguageFile=function(e){var i=this;return e&&g.openTextDocument({language:e.toLowerCase()}).then(function(t){return k.showTextDocument(t).then(function(e){return i._start(t,e,x)})})},h.prototype._stop=function(t){t.disposable&&t.disposable.dispose(),this._activeSessions.splice(this._activeSessions.findIndex(function(e){return e===t}),1),this._hideStatusIndicator(),_.isEmpty(this._activeSessions)&&this.emit("allSessionStopped")},h.prototype._hideStatusIndicator=function(){this._statusBar.stopProgress(),this._statusBar.hide()},h.prototype._relativeNormalizedFilePath=function(e){return this._utils.normalizePath(d.relative(this._projectRoot(),e))},h.prototype._runFromExistingFile=function(e){var t=k.activeTextEditor;if(t){var i=t.document;if(i){var n=this._activeSessions.find(function(e){return e.textDocument===i});n&&this._stop(n),S[i.languageId]?this._start(i,t,e):"output"===i.uri.scheme&&"wallaby-output"===i.languageId?this._activeSession&&!this._activeSession.isDisposed()&&this._start(this._activeSession.textDocument,this._activeSession.editors[0],this._activeSession.mode):k.showWarningMessage('Language "'+i.languageId+'" is not supported')}}},h.prototype._runIfAllowed=function(e){!this._liveShareServerActive()||this._liveShare.serverAllowed?e():this._showLiveShareWarningMessage(e)},h.prototype._showLiveShareWarningMessage=function(t){var i=this;k.showWarningMessage("When sharing outside read-only mode, the Quokka.js extension will execute CODE WRITTEN BY OTHERS ON YOUR COMPUTER. Select 'Allow' to continue executing Quokka.js during your Live Share Session.",{title:"Allow",allow:!0},{title:"Deny",allow:!1}).then(function(e){i._liveShare.serverAllowed=!(!e||!e.allow),i._liveShare.serverAllowed?t&&t():i._activeSessions.length&&(k.showInformationMessage("All Quokka.js instances have been stopped."),i.stopAll())})},h.prototype._liveShareClientActive=function(){return!!(this._liveShare&&this._liveShare.client&&this._liveShare.client.isServiceAvailable)},h.prototype._liveShareServerActive=function(){return!!(this._liveShare&&this._liveShare.server&&this._liveShare.server.isServiceAvailable)},h.prototype._sendToLiveShareClients=function(e,t,i){this._liveShareServerActive()&&this._liveShare.server.notify(e,{file:t.liveShareFileName,originalFile:t.textDocument.uri,fileName:t.fileName,data:i})},h.prototype._start=function(n,e,t){var i=this;this._updateConfigurationFromSettings(),h._checkConfigurationSettings();var o=this._liveShareClientActive(),s=o?{}:new this._Session;o&&(s.isDisposed=function(){return!1},s.stop=function(){});var a,r,u=new v;if(this._activeSession&&this._activeSession.output.disableChannel(),u.add(function(){i._sendToLiveShareClients("stopped",s)}),u.add(function(){i._valueExplorer.remove(s)}),this._watcher||o||(this._watcher=g.createFileSystemWatcher("**/*.*"),this._disposables.add(this._watcher)),o||(u.add(f.languages.registerHoverProvider(n.languageId,{provideHover:function(e,t){if(e===n&&!_.isEmpty(s.errorDataByLine)){var i=(s.errorDataByLine[t.line]||{}).hover;if(i)return new f.Hover(i.value)}}})),u.add(f.languages.registerCodeActionsProvider(n.languageId,{provideCodeActions:function(e,t){if(e===n&&!_.isEmpty(s.errorDataByLine)){var i=(s.errorDataByLine[t.start.line]||{}).commands;if(i)return i}}}))),t===x&&!o){var c=function(){s.runTests({file:s.fileName,externalFileChange:!0})};u.add(this._watcher.onDidCreate(c)),u.add(this._watcher.onDidChange(c)),u.add(this._watcher.onDidDelete(c))}(s.mode=t,s.disposable=u,s.textDocument=n,s.changes=[],s.fileName="quokka"+S[n.languageId],s.documentUpdates={},"file"===n.uri.scheme)?a=(r=n.uri.path.split("/"))[r.length-1]:a="vsls"===n.uri.scheme?(r=n.uri.path.split("/"))[r.length-1]:n.uri.path+S[n.languageId];if(s.id=a,"file"===n.uri.scheme&&this._projectRoot(n.uri.fsPath)){var l=this._relativeNormalizedFilePath(n.uri.fsPath);l&&(s.fileName=l,this._liveShareServerActive()&&(s.liveShareFileName=this._liveShare.api.convertLocalUriToShared(n.uri)))}"vsls"===n.uri.scheme&&o&&(s.fileName=n.uri.path),s.editors=[e],s.liveConsoleOutput=[],s.allLiveConsoleOutput=[],this._activeSessions.push(s),u.add(g.onDidCloseTextDocument(function(e){n===e&&i._stop(s)})),u.add(g.onDidChangeTextDocument(function(e){n===e.document&&(s.mode===x?i._processDocumentContentChange(s,e.document,e.contentChanges,!0):(i._hideStatusIndicator(),i._clearDecorations(s),i._processDocumentContentChange(s,e.document,e.contentChanges,!1)))})),u.add(g.onDidSaveTextDocument(function(e){n===e&&i._processDocumentContentChange(s,e,[],!0)})),u.add(k.onDidChangeActiveTextEditor(function(e){var t=s.editors.includes(e);s.editors=s.editors.filter(function(e){return k.visibleTextEditors.includes(e)}),k.visibleTextEditors.filter(function(e){return e.document===n}).forEach(function(e){s.editors.includes(e)||(s.editors.push(e),i._updateDocuments(s,s.documentUpdates))}),t&&i._updateDocuments(s,s.documentUpdates)}));var p=_.bind(this._absoluteFilePath,this);s.output=new m(this.outputChannel,s.fileName,p,this._state.coreClient.dmp,s.disposable,this._outputDocumentSelector,!!this._projectRoot(),this._liveShareClientActive(),s.id),this._colorizeOutput?s.output.useMarkup():s.output.disableMarkup(),o||(s.start({localRoot:this._projectRoot(),quokkaFolder:this._quokkaFolder,client:"VSCode",cv:f.version,fileName:s.fileName,editorTypeScript:d.join(process.mainModule.filename,"../../extensions/node_modules/typescript")}),s.on("notification",function(e){return i._showNotification(e,s)}),s.on("busy",function(){i._sendToLiveShareClients("busy",s),i.processSessionBusy(s)}),s.on("stopped",function(e){i._sendToLiveShareClients("stopped",s),i._stop(s),i._hideStatusIndicator(),e.deactivate&&(i.stopAll(),i._forceDeactivate())}),s.on("started",function(){i._sendToLiveShareClients("started",s,{mode:s.mode}),i.processStarted(s)}),s.on("stats",function(e){i._sendToLiveShareClients("stats",s,e),s.stats=e,delete s.status,delete s.liveConsoleOutput,delete s.allLiveConsoleOutput,i.processStats(s),e&&e.messages&&i._valueExplorer.update(s,e.messages)}),s.on("live",function(){s.fileChangedInEditor(s.fileName,s.textDocument.getText()),s.fileOpenedInEditor(s.fileName)}),s.on("configChanged",function(e){i._pro=e&&e.pro,s.output.setHeaderData(e),s.headerData=e,i._sendToLiveShareClients("configChanged",s,e)}),s.on("documentUpdates",function(e){i._updateDocuments(s,e),i._sendToLiveShareClients("documentUpdates",s,e)}),s.on("consoleError",function(e){e&&e.split("\n").forEach(function(e){return e&&i._debugOutputChannel.appendLine("[Error] #"+s.id+" "+e,"error")}),s.emit("stats",e)}),s.on("consoleLog",function(e){e&&e.split("\n").forEach(function(e){return e&&i._debugOutputChannel.appendLine("[Info]  #"+s.id+" "+e)})}),s.on("consoleOutput",function(e){i._sendToLiveShareClients("consoleOutput",s,e),i._displayLiveConsoleOutput(s,e)})),s.status="progress",this._updateStatus(s,"progress"),u.add(function(){s.output.dispose(),s.stop(),i._clearDecorations(s),delete s.editors,delete s.disposable,delete s.output,s===i._activeSession&&delete i._activeSession,h._clearIdleSessionTimeout(s),i._debugOutputChannel.appendLine("[Info]  #"+s.id+" Quokka.js stopped"),i.outputChannel.clear()}),this.emit("started")},h.prototype.processStats=function(e){e.stats&&(h._outputResults(e.output,e.stats),this._processErrors(e)),this._updateStatus(e),h._sessionIsActive(e)},h.prototype.processStarted=function(e){this._debugOutputChannel.appendLine("[Info]  #"+e.id+" Quokka.js started"),f.workspace.getConfiguration().get("quokka.showOutputOnStart",!0)&&(this._liveShareClientActive()?this._liveShare.outputChannelShown||(this._liveShare.outputChannelShown=!0,this.outputChannel.show(!0)):this.outputChannel.show(!0)),k.showTextDocument(e.textDocument,e.editors&&(e.editors.length||void 0)&&e.editors[0]&&e.editors[0].viewColumn)},h.prototype.processSessionBusy=function(e){var t=this;clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",t._updateStatus(e,"progress")},300),e.liveConsoleOutput=[],e.allLiveConsoleOutput=[],this._scheduleSessionIdleTimeout(e)},h.prototype._forceDeactivate=function(){this._deactivator(),_.each(y,function(e){return f.commands.registerCommand("quokka."+e,function(){return k.showWarningMessage("Please restart VS Code for a new trial session of Quokka.js 'Pro'.")})})},h.prototype._showNotification=function(e,t){var i=this,n=[];if(!~e.text.indexOf("expire")||"warning"!==e.type||!this._suppressExpirationNotifications){var o=function(e){return e&&e.url&&f.commands.executeCommand("vscode.open",e.url)};if(e.invalidVersion){e.text="You are not licensed to use Quokka PRO features for this version of VS Code. As your 12 months of free Quokka updates have expired, this is likely a result of VS Code updating itself OR that your Quokka extension has automatically updated.",n.push({title:"Renew",url:f.Uri.parse("https://quokkajs.com/pro"),command:o}),n.push({title:"Activate",command:"quokka.showLicense"}),n.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"});var s="https://quokkajs.com/docs/previous.html?expirydate="+(a=new Date(e.expiryDate)).getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate();e.compatibleEditorVersion&&(s=s+"&editortype=VSCode&editor="+encodeURIComponent("VS Code version "+e.compatibleEditorVersion),e.text=e.text+" The last version of VS Code compatible with your license is "+e.compatibleEditorVersion+"."),n.push({title:"Help / Downgrade",url:f.Uri.parse(s),command:o})}else if(e.expiringSoon){var a=new Date(e.expiryDate);e.text="Your Quokka license free upgrades period expires on "+e.expirationDateStringFormatted+". If you would like to work with the latest version of Quokka and future versions released within the next 12 months, please visit our website to upgrade your license.",n.push({title:"Renew",url:f.Uri.parse("https://quokkajs.com/pro"),command:o}),n.push({title:"Activate",command:"quokka.showLicense"});s="https://quokkajs.com/docs/previous.html?expirydate="+a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate();n.push({title:"Help",url:f.Uri.parse(s),command:o})}else e.suggestProEdition?(n.push({title:"Switch to 'Pro'",command:function(){return i._switchEdition(!0,t)}}),n.push({title:"More info",url:f.Uri.parse("https://quokkajs.com/pro"),command:o})):(~e.text.indexOf("continue-trial-link")&&n.push({title:"Continue Trial",command:function(){return t&&!t.isDisposed()&&t.continueTrial()}}),~e.text.indexOf("activate-link")&&n.push({title:"Activate License",command:"quokka.showLicense"}),~e.text.indexOf("purchase")&&(n.push({title:"Purchase",url:f.Uri.parse("https://quokkajs.com/pro"),command:o}),n.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"})));e.allowMuting&&n.push({title:"Don't show again",command:function(){return t&&!t.isDisposed()&&t.muteNotification(e.id)}}),e.text=e.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");var r=[e.text].concat(n);k["show"+e.type.charAt(0).toUpperCase()+e.type.substr(1)+("info"===e.type?"rmation":"")+"Message"].apply(k,r).then(this._executeCommand),0===e.text.indexOf("Can not start node.js process")&&k.showInformationMessage('You may use the "node" setting to configure the location of node.',{title:"More info",url:f.Uri.parse("https://quokkajs.com/docs/configuration.html#nodejs-version")}).then(function(e){e&&e.url&&f.commands.executeCommand("vscode.open",e.url)})}},h.prototype._checkAndSyncSession=function(t){return!!k.visibleTextEditors.find(function(e){return e.document===t.textDocument})&&(t!=this._activeSession&&(this._activeSession&&this._activeSession.output.disableChannel(),(this._activeSession=t).output.enableChannel(),t.output.render(),this.processStats(t)),!0)},h.prototype.showLicense=function(){var r=this,u="";try{u=c.readFileSync(this._lkp).toString()}catch(e){}k.showInputBox({value:100<u.length?u:"",prompt:"Enter your Quokka.js 'Pro' license key"}).then(function(e){if(!_.isUndefined(e)){var t=u,i=e||"",n=!!r._parseLicenseKey(t),o=r._parseLicenseKey(i),s=!!o,a=!1;if(s||!i&&n)try{c.writeFileSync(r._lkp,i),a=s}catch(e){k.showErrorMessage("Unable to save license key: "+e.message),a=!1}else k.showWarningMessage("The entered license key is not a valid Quokka.js 'Pro' license key.");a&&(k.showInformationMessage("Quokka.js 'Pro' is licensed to: "+o.licensee+". Free upgrades until: "+o.expiration+"."),r.switchToPro())}})},h.prototype._parseLicenseKey=function(e){if(_.isString(e))try{var t=this._utils.parseKey(e);if(t.licenseeName&&t.expirationDateString&&~t.licensedProduct.indexOf("Quokka"))return{licensee:t.licenseeName,expiration:t.expirationDateStringFormatted||t.expirationDateString}}catch(e){return}},h.prototype.switchToCommunity=function(){this._switchEdition(!1,this._activeSession)},h.prototype.switchToPro=function(){this._switchEdition(!0,this._activeSession)},h.prototype._switchEdition=function(e,t){var i=this._loadQuokkaConfig();if(i.pro=e,this._pro=e,this._saveQuokkaConfig(i),this._pro&&this._salesEvent&&(this._salesEvent.deleteStateConfig(),this._salesEvent.dispose(),delete this._salesEvent),!this._liveShareClientActive()&&t&&!t.isDisposed()){var n=t.textDocument,o=t.editors[0];this.stopAll(),t.mode!=x&&t.mode!==C||this._start(n,o,t.mode)}},h.prototype._processErrors=function(e){var t=this;this._liveShareClientActive()||e.stats.errors&&(e.errorDataByLine={},h._addLineData(e,h._createLineDataObject(e,function(e){return e.missingPackage},function(e){return[{title:'Install "'+e.missingPackage+'" package for the current quokka file',command:"installMissingPackageToQuokka"},t._projectRoot()&&{title:'Install "'+e.missingPackage+'" package into the project',command:"installMissingPackageToProject"}]})),h._addLineData(e,h._createLineDataObject(e,function(e){return e.missingBrowserGlobal},function(e){return[{title:'"'+e.missingBrowserGlobal+'" looks like a browser global'},{title:"Install and use quokka browser plugin",command:"installQuokkaPlugin",arg:"jsdom-quokka-plugin"}]})),h._addLineData(e,h._createLineDataObject(e,function(e){return e.undefinedName},function(e){return[{title:'Add "import '+e.undefinedName+" from '"+e.undefinedName+"';\"",command:"addImport",arg:e.undefinedName},{title:'Add "const '+e.undefinedName+" = require('"+e.undefinedName+"');\"",command:"addRequire",arg:e.undefinedName}]})))},h._addLineData=function(e,t){t&&(e.errorDataByLine[t.line]=t)},h._createHoverObject=function(e){return e.filter(function(e){return!!e}).map(function(e){return e.command?"\n["+e.title+"]("+encodeURI("command:quokka."+e.command+(e.arg?"?"+JSON.stringify(e.arg):""))+")":e.title}).join("\n")},h._createCommands=function(e){return e.filter(function(e){return e&&e.command}).map(function(e){return{title:e.title,command:"quokka."+e.command,arguments:e.arg?[e.arg]:void 0}})},h._createLineDataObject=function(t,e,i){var n=t.stats.errors.find(e),o=n&&n.stack||[];if(o.reverse(),o.length){var s=_.find(o,function(e){return e.file===t.fileName});if(s&&s.loc&&s.loc.split){var a=i(n),r=h._createHoverObject(a);return f.MarkdownString&&((r=new f.MarkdownString(r)).isTrusted=!0),{line:parseInt(s.loc.split(":")[0],10)-1,hover:{value:r},commands:h._createCommands(a)}}}},h._checkConfigurationSettings=function(){try{var e=f.workspace.getConfiguration();e&&!e.get("editor.glyphMargin",!0)&&k.showWarningMessage("Quokka.js will not display coverage indicators in the gutter because the `editor.glyphMargin` setting is set to `false`.")}catch(e){}},h.prototype._updateConfigurationFromSettings=function(){var e="",t=!1;try{var i=this._loadQuokkaConfig();e=i.node,i.useWsl&&(t=i.useWsl)}catch(e){}try{process.env.WALLABY_USE_WSL=t;var n=f.workspace.getConfiguration();if(n){this._suppressExpirationNotifications=n.get("quokka.suppressExpirationNotifications",!1),this._colorizeOutput=n.get("quokka.colorizeOutput",!0);var o=n.get("quokka.node",e);o?process.env.WALLABY_NODE=o:delete process.env.WALLABY_NODE}}catch(e){}},h.prototype.activate=function(){var e=this;this._onceDocumentStopsChanging=_.debounce(_.bind(this._onceDocumentStopsChanging,this),100),h._outputResults=_.debounce(_.bind(h._outputResults,this),100),this._statusBar.updateText=_.debounce(_.bind(this._statusBar.updateText,this._statusBar),200),this._executeCommand=_.bind(this._execute,this),this._statusBar.command="quokka.showOutput",this._disposables.add(function(){e._statusBar&&e._statusBar.hide(),e._activeSessions.forEach(function(e){return e.disposable.dispose()}),e._activeSessions.length=0})},h.prototype._projectRoot=function(t){var e,i=this;if(t&&(this._multiFolderWorkspaces&&g.workspaceFolders&&g.workspaceFolders.length&&(e=_.find(g.workspaceFolders,function(e){return~t.indexOf(e.uri.fsPath+d.sep)}))))return this._currectProjectRoot=e.uri.fsPath,this._currectProjectRoot;if(this._currectProjectRoot)if(this._multiFolderWorkspaces&&g.workspaceFolders){if(e=_.find(g.workspaceFolders,function(e){return i._currectProjectRoot===e.uri.fsPath}))return e.uri.fsPath}else if(g.rootPath&&this._currectProjectRoot===g.rootPath)return g.rootPath;return this._multiFolderWorkspaces&&g.workspaceFolders?g.workspaceFolders.length?g.workspaceFolders[0].uri.fsPath:void 0:g.rootPath||""},h.prototype.selectWorkspaceFolder=function(){var t=this;this._multiFolderWorkspaces&&g.workspaceFolders&&1<g.workspaceFolders.length&&k.showWorkspaceFolderPick&&k.showWorkspaceFolderPick().then(function(e){e&&(t._currectProjectRoot=e.uri.fsPath)})},h.prototype.deactivate=function(){this._disposables.dispose()},h._sessionIsActive=function(e){h._clearIdleSessionTimeout(e)},h.prototype._sessionIsIdle=function(e){this._clearDecorations(e),delete e.stats,e.liveConsoleOutput&&!e.liveConsoleOutput.started&&e.output.clearAndRenderHeader()},h._clearIdleSessionTimeout=function(e){e.idleTimeout&&(clearTimeout(e.idleTimeout),delete e.idleTimeout)},h.prototype._clearDecorations=function(e){var i=this;e.editors.forEach(function(t){_.each(i._coverageDecorationTypes,function(e){return t.setDecorations(e,[])}),t.setDecorations(i._hideAfterContentDecorationType,[])})},h.prototype._scheduleSessionIdleTimeout=function(e){var t=this;h._clearIdleSessionTimeout(e),e.idleTimeout=setTimeout(function(){return t._sessionIsIdle(e)},3500)},h.prototype._displayLiveConsoleOutput=function(e,t){var i=this;if(e.liveConsoleOutput){var n=e.liveConsoleOutput.started;e.liveConsoleOutput=e.liveConsoleOutput.concat(t),e.liveConsoleOutput.started=n,e.liveConsoleOutput.started?e.displayLiveConsoleOutputTimeout||this._displayPendingLiveConsoleOutput(e):(e.liveConsoleOutput.started=!0,e.displayLiveConsoleOutputTimeout=setTimeout(function(){delete e.displayLiveConsoleOutputTimeout,e.liveConsoleOutput&&e.liveConsoleOutput.length&&(e.output.clearAndRenderHeader(),i._displayPendingLiveConsoleOutput(e))},150))}},h.prototype._displayPendingLiveConsoleOutput=function(t){t.allLiveConsoleOutput=t.allLiveConsoleOutput.concat(t.liveConsoleOutput),t.liveConsoleOutput.forEach(function(e){return t.output.appendConsoleMessage(e)}),t.liveConsoleOutput.length=0},h.prototype._execute=function(e){if(e&&e.command)return"function"==typeof e.command?e.command(e):~e.command.indexOf("quokka.")?f.commands.executeCommand(e.command):this[e.command]()},h.prototype._processDocumentContentChange=function(e,t,i,n){e.isDisposed()||t&&t.uri&&t.uri.scheme&&"file"!==t.uri.scheme&&"untitled"!==t.uri.scheme&&"vsls"!==t.uri.scheme||(e.changes=e.changes.concat(i),this._hideMessagesForChangedRanges(e.changes),n&&this._onceDocumentStopsChanging(e,t))},h.prototype._onceDocumentStopsChanging=function(e,t){var i=this;!e.isDisposed()&&e.changes.length&&(this._liveShareClientActive()||(clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",i._updateStatus(e,"progress")},300),e.fileChangedInEditor(e.fileName,t.getText(),{start:_.chain(e.changes).map(function(e){return e.range.start.line}).min().value()+1,end:_.chain(e.changes).map(function(e){return e.range.end.line}).max().value()+1},!1),e.changes=[]))},h.prototype._updateStatus=function(e){if(!e.isDisposed()){var t,i=e.status;clearTimeout(this._statusUpdateTimeout),i||(i=_.isString(e.stats)?"failing":e.stats?e.stats.errors.length?"failing":"passing":"failing",t=e.stats&&e.stats.time),i&&("progress"===i?this._statusBar.displayProgress():(this._statusBar.stopProgress(),this._statusBar.setMainText(("failing"===i?"✗":"✔")+(t?" "+t+"ms":"")),this._statusBar.updateText()),this._statusBar.show()),this._activeSession=e}},h.prototype._updateStatusExtension=function(e){this._statusBar.setExtensionText(e),this._statusBar.updateText()},h.prototype._removeStatus=function(){this._statusBar.hide()},h.prototype._updateDocuments=function(t,n){var s=this;t.isDisposed()||(t.documentUpdates=n,_.each(k.visibleTextEditors,function(i){if(i.document===t.textDocument){var e=n[t.fileName];if(e&&e.lines){var o={1:[],2:[],3:[],4:[],5:[]};_.each(e.lines,function(e){var t={range:new f.Range(e.num-1,0,e.num-1,1e3)},i=e.log||e.err,n=e.longLog||i;n&&(t.hoverMessage=f.MarkdownString?new f.MarkdownString("```\n"+n+"\n```"):{value:n}),o[e.state].push(t),i&&(t.renderOptions={after:{contentText:"  "+i}})}),_.each(o,function(e,t){return i.setDecorations(s._coverageDecorationTypes[t],e)}),s._scheduleHiddenMessagesDisplay()}}}))},h.prototype._hideMessagesForChangedRanges=function(e){clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,k.activeTextEditor&&k.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,e.map(function(e){return{range:new f.Range(e.range.start.line,0,e.range.end.line,1e3)}}))},h.prototype._scheduleHiddenMessagesDisplay=function(){var t=this;clearTimeout(this._displayHiddenMessagesTimeout);var e=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(function(){try{_.each(k.visibleTextEditors,function(e){return e&&e.setDecorations(t._hideAfterContentDecorationType,[])})}catch(e){}},Math.max(0,500-e))},h.prototype._navigate=function(e,t){if(e){var i,n,o=this._absoluteFilePath(e);_.isNumber(t)?i=t:_.isArray(t)?(i=t[0],n=t[1]):_.isString(t)&&(t=t.split(":"),i=t[0]&&parseInt(t[0],10),n=t[1]&&parseInt(t[1],10)),_.isNumber(i)?i-=1:i=0,_.isNumber(n)||(n=0),g.openTextDocument(o).then(function(e){return k.showTextDocument(e)}).then(function(e){var t=new f.Position(i,n);e.revealRange(new f.Range(t,t)),e.selection=new f.Selection(t,t)})}},h.prototype._absoluteFilePath=function(e){return d.resolve(this._projectRoot(),e)},h._outputResults=function(e,t,i){var n,o=e.lines();e.build(t);var s=e.lines();if(!(n=i||s.length!==o.length))for(var a=0,r=s.length;a<r;a++)if(e.areDifferent(s[a],o[a])){n=!0;break}n&&e.render()},h}(s);t.exports=h},{"./SalesEvent":3,"./compositeDisposable":4,"./outputBuilder":6,"./valueExplorer":7,fs:void 0,os:void 0,path:void 0,vscode:void 0}],6:[function(e,t,i){"use strict";var l=e("vscode"),h=global._,n={text:"",link:Array(2).join("​"),error:Array(3).join("​"),duration:Array(4).join("​"),suite:Array(5).join("​"),message:Array(6).join("​"),diffIns:Array(2).join("‌⁠"),diffDel:Array(2).join("‍"),tmpDiffInsOpen:"wsDiffIns",tmpDiffInsClose:"weDiffIns",tmpDiffDelOpen:"wsDiffDel",tmpDiffDelClose:"weDiffDel"},o=function(){function e(e,t,i,n,o,s,a,r,u){var c=this;this._lines=[],this._links=[],this._quokkaFileName=t,this._displayedFileName=u,this._contentLimit=1048576,this._channel=e,this._absolutePathResolver=i,this._dmp=n,this._hasOpenedProject=a,this.render=h.debounce(h.bind(this.render,this),300),this._header=this._channel.name,this.isLiveShareClient=r,this.disposed=!1,this.channelEnabled=!0,this.useMarkup(),o.add(l.languages.registerDocumentLinkProvider(s,{provideDocumentLinks:function(e){if(!c.channelEnabled||c.disposed)return[];var t=e.lineAt(0);return t&&t.text&&~t.text.indexOf(c._channel.name)?c._links:[]}}))}return e.prototype.enableChannel=function(){this.channelEnabled=!0},e.prototype.disableChannel=function(){this.channelEnabled=!1},e.prototype.useMarkup=function(){this._markupTokens=h.extend({},n)},e.prototype.disableMarkup=function(){this._markupTokens.text=this._markupTokens.link=this._markupTokens.error=this._markupTokens.duration=this._markupTokens.suite=this._markupTokens.message=""},e.prototype.dispose=function(){this.disposed=!0},e.prototype.build=function(e){var t=this;this._lines=[],this._links=[],this._appendLine("suite",0,this._header),h.isString(e)?this._appendLine("error",0,e):h.isObject(e)&&(h.each(e.errors,function(e){return t._outputError(e)}),h.each(e.messages,function(e){return t._outputMessage(e)}))},e.prototype.lines=function(){return this._lines},e.prototype.render=function(){this._doRender()},e.prototype._doRender=function(e){if(!this.disposed&&this.channelEnabled){!(e=e||0)&&this._channel.clear();for(var t="",i=e,n=this._lines.length;i<n;i++){if((t+=this._lines[i]+"\n").length>this._contentLimit){t+="\n--- output truncated to "+this._contentLimit+" bytes ---\n";break}}this._channel.append(t)}},e.prototype.clear=function(){this._lines=[],this._links=[]},e.prototype.clearAndRenderHeader=function(){this.clear(),this._appendLine("suite",0,this._header),this._doRender()},e.prototype.appendConsoleMessage=function(e){var t=this._lines.length;this._outputMessage(e),this._doRender(t)},e.prototype.show=function(){this.disposed||this._channel.show(!0)},e.prototype.areDifferent=function(e,t){return e!==t},e.prototype.setContentLimit=function(e){e&&(this._contentLimit=e)},e.prototype.setHeaderData=function(e){if(!this.disposed){var t=e.plugins||[];try{this._header=this._channel.name+" '"+this._displayedFileName+"' (node: "+e.nodeVersion+(e.ts?", TypeScript: "+(e.ts.version&&"v"+e.ts.version||"unknown version"):"")+(e.babel?", babel: "+(e.babel.version&&"v"+e.babel.version||"unknown version"):"")+(t.length?", plugins: "+t.join(", "):"")+")"}catch(e){console.log(e)}}},e.prototype._outputMessage=function(e){if("diff"===e.type){if(!e.context&&!e.actual&&!e.expected)return;e.text=e.context,delete e.context}e.context&&e.context.replace&&(e.context=e.context.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));var t=e.text&&(20<e.text.length||~e.text.indexOf("\n"))&&"diff"!==e.type,i="error"===e.type?"error":"warn"===e.type||"diff"===e.type?"duration":"message";if(t)this._appendLine(i,0,"\n"+e.text),this._outputLink(e,1);else{"diff"===e.type&&this._outputDiff(0,e.expected,e.actual);var n=e.text?"\n"+this._markupTokens[i]+e.text+this._markupTokens[i]:"";if(e.file){n+=" ";var o=this._markupTokens.link+e.file+(e.loc?":"+e.loc:"")+this._markupTokens.link;n+="at "+(e.context?this._markupTokens.duration+e.context+this._markupTokens.duration+" ":""),n+=o,this._addFileLink(e.file,e.loc,o,n.length-o.length,this._lines.length+1)}this._appendLine("text",0,n)}},e.prototype._outputError=function(e){var t=e.message,i=e.stack,n=e.expected,o=e.actual,s=e.missingPackage,a=e.missingBrowserGlobal,r=this;this._outputDiff(0,n,o),s&&!this.isLiveShareClient&&(this._addEmptyLine(),this._addCustomLinkLine('Install "'+s+'" package for the current quokka file',"command:quokka.installMissingPackageToQuokka",0),this._hasOpenedProject&&this._addCustomLinkLine('Install "'+s+'" package into the project',"command:quokka.installMissingPackageToProject",0)),a&&!this.isLiveShareClient&&(this._addEmptyLine(),this._appendLine("duration",0,'"'+a+'" looks like a browser global'),this._addCustomLinkLine("Install and use quokka browser plugin","command:quokka.installQuokkaPlugin?"+JSON.stringify("jsdom-quokka-plugin"),0),this._addCustomLinkLine("Open quokka browser plugin documentation","https://github.com/wallabyjs/jsdom-quokka-plugin",0)),this._appendLine("error",0,"\n"+t),h.each(i,function(e){return r._outputLink(e,1)})},e.prototype._outputDiff=function(e,t,i){var s=this;if(this._dmp&&(t||i)){var n="\n"+this._dmp.diff_prettyHtml(this._dmp.diff_wordMode(t||"",i||"")).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,this._markupTokens.tmpDiffInsOpen).replace(/<del[^>]*>/g,this._markupTokens.tmpDiffDelOpen).replace(/<\/ins[^>]*>/g,this._markupTokens.tmpDiffInsClose).replace(/<\/del[^>]*>/g,this._markupTokens.tmpDiffDelClose).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),a=0,r=0;this._appendLine("none",e,n,void 0,void 0,function(e){if(!e)return e;0<a&&(e=s._markupTokens.diffIns+e),0<r&&(e=s._markupTokens.diffDel+e);var t=(e.match(new RegExp(s._markupTokens.tmpDiffInsOpen,"g"))||[]).length,i=(e.match(new RegExp(s._markupTokens.tmpDiffInsClose,"g"))||[]).length;a+=t-i;var n=(e.match(new RegExp(s._markupTokens.tmpDiffDelOpen,"g"))||[]).length,o=(e.match(new RegExp(s._markupTokens.tmpDiffDelClose,"g"))||[]).length;return r+=n-o,0<a&&(e+=s._markupTokens.diffIns),0<r&&(e+=s._markupTokens.diffDel),e.replace(new RegExp(s._markupTokens.tmpDiffInsOpen,"g"),s._markupTokens.diffIns).replace(new RegExp(s._markupTokens.tmpDiffInsClose,"g"),s._markupTokens.diffIns).replace(new RegExp(s._markupTokens.tmpDiffDelOpen,"g"),s._markupTokens.diffDel).replace(new RegExp(s._markupTokens.tmpDiffDelClose,"g"),s._markupTokens.diffDel)})}},e.prototype._outputLink=function(i,e){var n=this;if(i.file){var o=i.file+(i.loc?":"+i.loc:"");this._appendLine("link",e,o,void 0,i.context,function(e,t){n._addFileLink(i.file,i.loc,o,t)})}},e.prototype._addCustomLinkLine=function(e,t,i){var n=this._lines.length;this._appendLine("text",i,this._markupTokens.link+e+this._markupTokens.link),this._links.push({range:new l.Range(n,this._markupTokens.link.length,n,e.length+this._markupTokens.link.length),target:l.Uri.parse(t)})},e.prototype._addFileLink=function(e,t,i,n,o){"."!==e[0]&&e!==this._quokkaFileName||(o=o||this._lines.length,this._links.push({range:new l.Range(o,n,o,n+i.length),target:0===e.indexOf("quokka")?l.Uri.parse("command:quokka.goToLineInQuokkaFile?"+JSON.stringify(this._location(t).substring(1))):l.Uri.parse(l.Uri.file(this._absolutePathResolver(e)).toString()+this._location(t))}))},e.prototype._location=function(e){var t,i;return h.isNumber(e)?t=e:h.isArray(e)?(t=e[0],i=e[1]):h.isString(e)&&(t=(e=e.split(":"))[0]&&parseInt(e[0],10),i=e[1]&&parseInt(e[1],10)),"#"+(h.isNumber(i)?t+","+(i+1):t)},e.prototype._addEmptyLine=function(){this._appendLine("text",0,"")},e.prototype._appendLine=function(o,s,e,a,r,u){var c=this,l=this,t=e.split("\n"),p=this._markupTokens[o]||"";h.each(t,function(e){var t=(a?"["+a+"] ":"")+h.pad("",2*s,"   ")+("link"===o?"at "+(r?c._markupTokens.duration+r+c._markupTokens.duration+" ":""):"")+p,i=t+e+p;if(u){var n=u(i,t.length);n&&(i=n)}l._lines.push(i)})},e}();t.exports=o},{vscode:void 0}],7:[function(e,t,i){"use strict";var n=e("vscode"),s=global._,o=function(){function o(e){this._treeDataProvider=new u,this._treeDataProvider._rootNodes={},this._context=e,n.window.registerTreeDataProvider&&n.window.registerTreeDataProvider("quokkaValueExplorer",this._treeDataProvider)}return o.prototype.remove=function(e){var t=this._treeDataProvider._rootNodes,i=t[e.id];delete t[e.id],i&&i._context.cancelPendingUpdates(),this._treeDataProvider.refresh()},o.prototype.update=function(e,t){var i=this._treeDataProvider._rootNodes[e.id];if(!i){var n=new a(this._context,e);i=new r(n,{label:{name:""+e.id},id:e.id,sessionNode:!0,disallowToCopyPath:!0,disallowToCopyData:!0}),this._treeDataProvider._rootNodes[e.id]=i}i._children=s.chain(t).map(function(e){var t=(e.valueBag||{}).data;if(t){t.name||o.removeSpacesTabsLineBreaks(e.text).startsWith(s.rtrim(o.removeSpacesTabsLineBreaks(e.context),"..."))||(t.name=o.removeSpacesTabsLineBreaks(e.context));var i=(e.loc||"").split(":")[0];return i&&(t.name="line "+i+(t.name?": "+t.name:"")),t.label=t.label||{},t.label.name=t.name,t.context=e.context,t.rootValueNode=!0,t}}).filter(function(e){return!!e}).map(function(e){return new r(i._context,e,i)}).value(),i._context.runPendingUpdates(),i._children&&i._children.length||(i._children=[{label:"No logged values"}]),this._treeDataProvider.refresh()},o.removeSpacesTabsLineBreaks=function(e){return e&&e.replace(/\s/g,"")},o}(),a=function(){function e(e,t){this._expressionsToEvaluate={},this._onUpdate=[],this._extensionContext=e,this._session=t,this.id=t.id}return e.prototype.asAbsolutePath=function(e){return this._extensionContext.asAbsolutePath(e)},e.prototype.isPathRequested=function(e,t){var i=this._expressionsToEvaluate,n=s.every(e,function(e){return!!i[e]&&(i=i[e],!0)});return n&&t?JSON.stringify(t)===JSON.stringify(i):n},e.prototype.requestNodes=function(e,t){var i=this._expressionsToEvaluate;s.each(e,function(e){i[e]=i[e]||{},i=i[e]}),t&&(i.props=t.props,i.strLength=t.strLength,i.ranges=t.ranges),this._session.isDisposed()||(this._session.expressionsToEvaluate(this._expressionsToEvaluate),this._session.runTests({file:this._session.fileName}))},e.prototype.scheduleOnUpdate=function(e){this._onUpdate.push(e)},e.prototype.copyToClipboard=function(e){!this._session.isDisposed()&&this._session.copyToClipboard(e)},e.prototype.cancelPendingUpdates=function(){this._onUpdate=[]},e.prototype.runPendingUpdates=function(){s.each(this._onUpdate,function(e){return e()}),this._onUpdate.length=0},e}(),r=function(){function t(e,t,i){this._context=e,this._parent=i,this._data=t,this.label=this._createLabel(),this._queryPath=t.queryPath,this.id=t.id,this.iconPath=this._getIconPath(),t.disallowToCopyPath||(this.contextValue+="QuokkaAllowToCopyPath"),t.disallowToCopyData||(this.contextValue+="QuokkaAllowToCopyData"),t.sessionNode?this.collapsibleState=2:this.collapsibleState=t.expandable?1:0,t.rangeNode&&(this._parentArray=i._parentArray||i,this._queryPath=this._parentArray._queryPath),t.sessionNode&&(this.iconPath=n.ThemeIcon.File,this.resourceUri=n.Uri.file(this.id))}return t.prototype.getChildren=function(){var i=this;if(this._children)return this._children;if("string"===this._data.type)return this._getChildren({strLength:Number.MAX_VALUE});if(this._data.loadActionNode)return this._getChildren({props:Number.MAX_VALUE});var e=(this._data.props||[]).map(function(e){return new t(i._context,e,i)});return e.length?Promise.resolve(e):this._data.rangeNode?this._getChildren({ranges:{props:JSON.parse(JSON.stringify(this._parentArray._data.props,function(e,t){return t.props&&(!t.props.length&&t===i._data||t.props.length&&!t.props[0].rangeNode)&&(t.props=!0),t})),length:this._parentArray._data.length}}):this._getChildren()},t.prototype.copyExpressionPath=function(){(this._data||{}).expressionPath&&this._context.copyToClipboard(this._data.expressionPath.join(""))},t.prototype.copyExpressionData=function(){this._data&&this._context.copyToClipboard(this._data)},t.prototype._getChildren=function(e){var i=this;return this._context.isPathRequested(this._queryPath,e)?[]:(this._context.requestNodes(this._queryPath,e),new Promise(function(e,t){i._context.scheduleOnUpdate(e)}))},t.prototype._getIconPath=function(){if(this._data.getter)return this._context.asAbsolutePath("images/getter.svg");if(this._data.functionsNode)return this._context.asAbsolutePath("images/function.svg");if(this._data.loadActionNode)return this._context.asAbsolutePath("images/more.svg");if(this._data.error)return this._context.asAbsolutePath("images/error.svg");if(this._data.rangeNode)return this._context.asAbsolutePath("images/range.svg");if(!this._data.sessionNode){if(this._data.type)switch(this._data.type.toLowerCase()){case"string":if(this._data.capped)return this._context.asAbsolutePath("images/cappedString.svg");case"object":case"array":case"number":case"function":case"boolean":case"date":case"regexp":case"symbol":case"null":case"undefined":return this._context.asAbsolutePath("images/"+this._data.type.toLowerCase()+".svg")}return this._context.asAbsolutePath("images/object.svg")}},t.prototype._createLabel=function(){var e=this._data.label,t="";return e.name&&(t+=e.name),e.type&&(t+=": "+e.type+" "),e.value&&(t+=(e.type?"":": ")+e.value),t},t}(),u=function(){function e(){this._onDidChangeTreeData=new n.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}return e.prototype.refresh=function(){this._onDidChangeTreeData.fire()},e.prototype.getTreeItem=function(e){return e},e.prototype.getChildren=function(e){return e?e.getChildren():Promise.resolve(s.values(this._rootNodes))},e}();t.exports=o},{vscode:void 0}]},{},[2]);