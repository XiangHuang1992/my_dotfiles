{
    "type": "object",
    "definitions": {
        "version": {
            "description": "Version of the configuration file",
            "type": "string"
        },
        "job": {
            "type": "object",
            "properties": {
                "type": {
                    "description": "Project type",
                    "type": "string",
                    "enum": [
                        "General",
                        "Python",
                        "CNTK",
                        "Tensorflow",
                        "Theano",
                        "Caffe",
                        "Caffe2",
                        "Torch",
                        "PyTorch",
                        "MXNet",
                        "Chainer",
                        "Keras",
                        "Lasagne",
                        "CNTKPython",
                        "CNTKBrainScript",
                        "KerasCNTK",
                        "KerasTensorflow",
                        "KerasTheano"
                    ]
                },
                "files": {
                    "description": "Project files",
                    "type": "object",
                    "properties": {
                        "includes": {
                            "description": "Project files which include",
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    }
                },
                "name": {
                    "description": "Job name",
                    "type": "string",
                    "minLength": 1
                },
                "startupCommand": {
                    "description": "Job start up commmand",
                    "type": "string"
                },
                "startupScript": {
                    "description": "Job start up script",
                    "type": "string"
                },
                "arguments": {
                    "description": "Job start arguments",
                    "type": "string"
                },
                "workingDirectory": {
                    "description": "Job working directory",
                    "type": "string"
                },
                "batchArguments": {
                    "description": "Batch arguments for job",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "required": [
                            "suffixName",
                            "value"
                        ],
                        "properties": {
                            "suffixName": {
                                "description": "Suffix name of batch job",
                                "type": "string"
                            },
                            "value": {
                                "description": "Value of batch argument",
                                "type": "string"
                            }
                        }
                    }
                },
                "docker": {
                    "description": "Specify the docker information if you want to run the job in a docker.",
                    "type": "object",
                    "default": {
                        "useRoot": true
                    },
                    "properties": {
                        "type": {
                            "description": "The docker type",
                            "type": "string",
                            "enum": [
                                "Docker",
                                "NvidiaDocker"
                            ]
                        },
                        "image": {
                            "description": "The docker image name",
                            "type": "string",
                            "defaultSnippets": [
                                {
                                    "body": "tensorflow/tensorflow:1.5.0-py3"
                                },
                                {
                                    "body": "tensorflow/tensorflow:1.5.0-rc0-gpu-py3"
                                },
                                {
                                    "body": "microsoft/cntk:2.4-cpu-python3.5"
                                },
                                {
                                    "body": "microsoft/cntk:2.4-gpu-python3.5-cuda9.0-cudnn7.0"
                                },
                                {
                                    "body": "mxnet/python:1.1.0"
                                },
                                {
                                    "body": "mxnet/python:gpu_1.1.0"
                                },
                                {
                                    "body": "caffe2ai/caffe2:c2v0.8.1.cpu.full.ubuntu14.04"
                                },
                                {
                                    "body": "caffe2ai/caffe2:c2v0.8.1.cuda8.cudnn7.ubuntu16.04"
                                },
                                {
                                    "body": "chainer/chainer:v4.0.0b4"
                                },
                                {
                                    "body": "toolsforai/all-in-one:v0.1.cpu.ubuntu16.04.py3"
                                },
                                {
                                    "body": "toolsforai/all-in-one:v0.1.cuda9.cudnn7.ubuntu16.04.py3"
                                }
                            ]
                        },
                        "useRoot": {
                            "description": "Use root in docker",
                            "type": "boolean",
                            "default": true
                        }
                    },
                    "required": [
                        "type",
                        "image"
                    ]
                }
            },
            "required": [
                "startupScript"
            ]
        },
        "paiProperties": {
            "type": "object",
            "description": "Properties for PAI",
            "properties": {
                "autoUpload": {
                    "type": "boolean",
                    "description": "Enable source auto upload or not"
                },
                "jobConfig": {
                    "type": "object",
                    "description": "PAI job config",
                    "properties": {
                        "jobName": {
                            "type": "string",
                            "description": "Name for the job, need to be unique",
                            "pattern": "^[A-Za-z0-9\\-._~]+$"
                        },
                        "image": {
                            "type": "string",
                            "description": "URL pointing to the Docker image for all tasks in the job"
                        },
                        "authFile": {
                            "type": "string",
                            "description": "Docker registry authentication file existing on HDFS"
                        },
                        "dataDir": {
                            "type": "string",
                            "description": "Data directory existing on HDFS"
                        },
                        "outputDir": {
                            "type": "string",
                            "description": "Output directory on HDFS, $PAI_DEFAULT_FS_URI/Output/$jobName will be used if not specified"
                        },
                        "codeDir": {
                            "type": "string",
                            "description": "Code directory existing on HDFS"
                        },
                        "taskRoles": {
                            "type": "array",
                            "description": "List of taskRole, one task role at least",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "description": "Name for the task role, need to be unique with other roles",
                                        "pattern": "^[A-Za-z0-9\\-._~]+$"
                                    },
                                    "taskNumber": {
                                        "type": "integer",
                                        "description": "Number of tasks for the task role, no less than 1",
                                        "minimum": 1
                                    },
                                    "cpuNumber": {
                                        "type": "integer",
                                        "description": "CPU number for one task in the task role, no less than 1",
                                        "minimum": 1
                                    },
                                    "memoryMB": {
                                        "type": "integer",
                                        "description": "Memory for one task in the task role, no less than 100",
                                        "minimum": 100
                                    },
                                    "gpuNumber": {
                                        "type": "integer",
                                        "description": "GPU number for one task in the task role, no less than 0",
                                        "minimum": 0
                                    },
                                    "command": {
                                        "type": "string",
                                        "description": "Executable command for tasks in the task role, can not be empty",
                                        "pattern": "^.+$"
                                    }
                                },
                                "required": [
                                    "name",
                                    "taskNumber",
                                    "cpuNumber",
                                    "memoryMB",
                                    "gpuNumber",
                                    "command"
                                ]
                            },
                            "minItems": 1
                        },
                        "gpuType": {
                            "type": "string",
                            "description": "Specify the GPU type to be used in the tasks. If omitted, the job will run on any gpu type"
                        },
                        "minFailedTaskCount": {
                            "type": ["integer", "null"],
                            "description": "Number of failed tasks to kill the entire job, null or no less than 1",
                            "minimum": 1
                        },
                        "minSucceededTaskCount": {
                            "type": ["integer", "null"],
                            "description": "Number of succeeded tasks to kill the entire job, null or no less than 1",
                            "minimum": 1
                        },
                        "retryCount": {
                            "type": "integer",
                            "description": "Job retry count, no less than 0",
                            "minimum": 0
                        }
                    },
                    "required": [
                        "jobName",
                        "image",
                        "taskRoles"
                    ]
                }
            }
        }
    },
    "properties": {
        "version": {
            "$ref": "#/definitions/version"
        },
        "job": {
            "$ref": "#/definitions/job"
        },
        "platform": {
            "type": "object",
            "description": "Properties for each platform",
            "properties": {
                "PAI": {
                    "$ref": "#/definitions/paiProperties"
                }
            }
        }
    },
    "required": [
        "version",
        "job"
    ]
}