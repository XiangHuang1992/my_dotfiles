"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const vscode = __importStar(require("vscode"));
const JAVA_MODE = [
    { language: "java", scheme: "file" },
];
const JAVA_COMPLETION = "java.intellicode.completion";
const JAVA_COMPLETION_RESOLVE = "java.intellicode.completion.resolve";
const ENABLE_JAVA_INTELLICODE = "java.intellicode.enable";
const EXECUTE_WORKSPACE_COMMAND = "java.execute.workspaceCommand";
async function registerCompletionItemProvider(modelPath) {
    const result = await vscode.commands.executeCommand(EXECUTE_WORKSPACE_COMMAND, ENABLE_JAVA_INTELLICODE, true, modelPath);
    if (result) {
        return vscode.languages.registerCompletionItemProvider(JAVA_MODE, {
            provideCompletionItems(document, position, _token, completionContext) {
                return vscode.commands.executeCommand(EXECUTE_WORKSPACE_COMMAND, JAVA_COMPLETION, {
                    textDocument: { uri: document.uri.toString() },
                    position,
                    context: completionContext,
                });
            },
            resolveCompletionItem(item, _token) {
                return vscode.commands.executeCommand(EXECUTE_WORKSPACE_COMMAND, JAVA_COMPLETION_RESOLVE, item).then(convertCompletionItem);
            },
        }, ".", "@", "#", "*");
    }
    return false;
}
exports.registerCompletionItemProvider = registerCompletionItemProvider;
function convertCompletionItem(item) {
    if (item.textEdit) {
        try {
            item.insertText = new vscode.SnippetString(item.textEdit.newText);
            item.range = new vscode.Range(new vscode.Position(item.textEdit.range.start.line, item.textEdit.range.start.character), new vscode.Position(item.textEdit.range.end.line, item.textEdit.range.end.character));
            delete item.textEdit;
        }
        catch (error) {
            console.log(error);
        }
    }
    else if (item.insertTextFormat === 2) {
        item.insertText = new vscode.SnippetString(item.insertText);
    }
    return item;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUlBLCtDQUFpQztBQUVqQyxNQUFNLFNBQVMsR0FBNEI7SUFDdkMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUU7Q0FDdkMsQ0FBQztBQUVGLE1BQU0sZUFBZSxHQUFHLDZCQUE2QixDQUFDO0FBRXRELE1BQU0sdUJBQXVCLEdBQUcscUNBQXFDLENBQUM7QUFFdEUsTUFBTSx1QkFBdUIsR0FBRyx5QkFBeUIsQ0FBQztBQUUxRCxNQUFNLHlCQUF5QixHQUFHLCtCQUErQixDQUFDO0FBRTNELEtBQUsseUNBQXlDLFNBQWlCO0lBRWxFLE1BQU0sTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMseUJBQXlCLEVBQUUsdUJBQXVCLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBRXpILElBQUksTUFBTSxFQUFFO1FBQ1IsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLDhCQUE4QixDQUFDLFNBQVMsRUFBRTtZQUM5RCxzQkFBc0IsQ0FBQyxRQUE2QixFQUFFLFFBQXlCLEVBQ3hELE1BQWdDLEVBQ2hDLGlCQUEyQztnQkFDOUQsT0FBTyxNQUFNLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyx5QkFBeUIsRUFBRSxlQUFlLEVBQUU7b0JBQzlFLFlBQVksRUFBRSxFQUFFLEdBQUcsRUFBRSxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFO29CQUM5QyxRQUFRO29CQUNSLE9BQU8sRUFBRSxpQkFBaUI7aUJBQzdCLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxxQkFBcUIsQ0FBQyxJQUEyQixFQUFFLE1BQWdDO2dCQUMvRSxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLHlCQUF5QixFQUFFLHVCQUF1QixFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ2hJLENBQUM7U0FDSixFQUNHLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0tBQzNCO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQztBQXRCRCx3RUFzQkM7QUFFRCwrQkFBK0IsSUFBUztJQUNwQyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDZixJQUFJO1lBQ0EsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsRSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssQ0FDekIsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxFQUN4RixJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQ3ZGLENBQUM7WUFDRixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7U0FDeEI7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDdEI7S0FDSjtTQUFNLElBQUksSUFBSSxDQUFDLGdCQUFnQixLQUFLLENBQUMsRUFBRTtRQUVwQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDL0Q7SUFDRCxPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDIn0=