/*
 * quokka-vscode - v1.0.156
 * Copyright (c) 2017-2018 WallabyJs - All Rights Reserved.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}process.env.WALLABY_PRODUCTION=!0;var f="function"==typeof require&&require;module.exports=e(d[0])}({1:[function(a,b,c){"use strict";var d=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},e=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=2&c[0]?f.return:c[0]?f.throw||((g=f.return)&&g.call(f),0):f.next)&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[2&c[0],g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},f=a("fs"),g=a("path"),h=a("vscode"),i=a("vsls/vscode"),j=a("./lib/compositeDisposable"),k=h.window,l="quokkajs",m=function(){function b(){}return b.prototype.activate=function(c){return d(this,void 0,void 0,function(){var d,f,g,h,k;return e(this,function(e){switch(e.label){case 0:return d=this,d._disposables=new j,d._setupStatusIndicator(),f=a(c.globalState.get("corePath")),g={context:c,coreClient:f,statusBar:d._statusBar,deactivate:function(){return d.deactivate()},version:b._getVersion()},[4,i.getApiAsync()];case 1:return h=e.sent(),k=a("./lib/controller"),d._controller=new k(g,h,l),d._controller.activate(),d._disposables.add(function(){return d._controller.deactivate()}),d._disposables.add(function(){return h.unshareService(l)}),[2]}})})},b._getVersion=function(){var a=1,b=0;try{var c=h.version.split(".");a=parseInt(c[0],10),b=parseInt(c[1],10)}catch(a){}return{major:a,minor:b}},b.prototype._setupStatusIndicator=function(){var a=this;a._statusBar=k.createStatusBarItem(h.StatusBarAlignment.Right,Number.NEGATIVE_INFINITY),a._statusBar.show();var b=a._statusBar.hide.bind(a._statusBar),c=a._statusBar.dispose.bind(a._statusBar);a._statusBar.hide=function(){a._statusBar.stopProgress(),a._statusBar._mainText="",a._statusBar._extensionText="",a._statusBar.updateText(),b()},a._statusBar.dispose=function(){a._statusBar.stopProgress(),c()},a._statusBar.displayProgress=function(){var b=0,c=["[=-----]","[-=----]","[--=---]","[---=--]","[----=-]","[-----=]","[----=-]","[---=--]","[--=---]","[-=----]"];clearInterval(a._statusBar._progress),a._statusBar._progress=setInterval(function(){a._statusBar.setMainText(c[b=++b%c.length]+"   "),a._statusBar._doUpdateText()},150)},a._statusBar.setMainText=function(b){a._statusBar._mainText=b},a._statusBar.setExtensionText=function(b){a._statusBar._extensionText=b},a._statusBar.updateText=function(){return a._statusBar._doUpdateText()},a._statusBar._doUpdateText=function(){a._statusBar.text=(a._statusBar._mainText||"")+" "+(a._statusBar._extensionText||"")},a._statusBar.stopProgress=function(){clearInterval(a._statusBar._progress),delete a._statusBar._progress},a._statusUpdater=function(b){a._statusBar.tooltip=b},a._disposables.add(function(){a._removeStatusIndicator()})},b.prototype._hideStatusIndicator=function(){this._statusBar&&(this._statusBar.text="",this._statusBar.tooltip="",this._statusBar.hide()),this._statusUpdater=function(){}},b.prototype._removeStatusIndicator=function(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=function(){}},b.prototype.deactivate=function(){this._disposables.dispose()},b}();c.activate=function(a){var b=new m;a.subscriptions.push({dispose:function(){return b.deactivate()}});var c=m._getVersion();if(c.major<=1&&c.minor<18){var d=process.exit,e=function(){b.deactivate(),d.apply(process,arguments)},i=process.exit=function(){e.apply(null,arguments)};process.on("SIGINT",function(){i.apply(null,arguments)}),process.on("SIGTERM",function(){i.apply(null,arguments)}),process.on("exit",function(){i.apply(null,arguments)})}try{var j=h.workspace.getConfiguration();if(j){var k=j.get("quokka.colors",{});k&&Object.keys(k).forEach(function(b){try{if(!b)return;var c=a.asAbsolutePath(g.join("images",b+".svg"));if(!f.existsSync(c))return;var d=f.readFileSync(c).toString().replace(/fill:#.[^;]*/,"fill:"+k[b]);f.writeFileSync(c,d)}catch(a){console.error("Failed to set icon "+b+" type to "+k[b]+". "+a.message)}})}}catch(a){}b.activate(a)}},{"./lib/compositeDisposable":3,"./lib/controller":4,fs:void 0,path:void 0,vscode:void 0,"vsls/vscode":void 0}],2:[function(a,b,c){var d=a("vscode"),e=a("path");c.activate=function(b){var c=d.workspace.getConfiguration()&&d.workspace.getConfiguration().get("quokka.debug",!1);return c?(global.originalRequire=a,b.globalState.update("corePath","../wallaby/client")):b.globalState.update("corePath","./wallaby/client"),c||"dist"===e.basename(__dirname)?a("./extension").activate(b):(global.originalRequire=a,a("./dist/index").activate(b))}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(a,b,c){"use strict";var d=function(){function a(){this._disposables=[]}return a.prototype.add=function(a){a.dispose?this._disposables.push(a):this._disposables.push({dispose:a})},a.prototype.dispose=function(){this._disposables.forEach(function(a){return a.dispose()})},a}();b.exports=d},{}],4:[function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},f=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=2&c[0]?f.return:c[0]?f.throw||((g=f.return)&&g.call(f),0):f.next)&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[2&c[0],g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},g=a("path"),h=a("fs"),i=a("os"),j=a("vscode"),k=global._,l=global.EventEmitter,m=a("./compositeDisposable"),n=a("./outputBuilder"),o=j.workspace,p=j.window,q=300,r=3500,s="quokka",t=0,u=["showOutput","createFile","makeQuokkaFromExistingFile","runOnSave","runOnce","createJavaScriptFile","createTypeScriptFile","showInstrumentedFile","stopCurrent","stopAll","installMissingPackageToProject","installMissingPackageToQuokka","installQuokkaPlugin","goToLineInQuokkaFile","showLicense","switchToPro","switchToCommunity","selectWorkspaceFolder","addImport","addRequire","showValue"],v={javascript:".js",javascriptreact:".js",plaintext:".js",typescript:".ts",typescriptreact:".tsx"},w={automatic:0,onsave:1,once:2},x=function(a){function b(b,c,d){var e=a.call(this)||this,f=e;return e._state=b,e._context=b.context,e._statusBar=b.statusBar,e._deactivator=b.deactivate,e._Session=b.coreClient.Session,e._utils=b.coreClient.utils,e._outputDocumentSelector={language:"wallaby-output"},e._setupVersionSpecificComponents(b.version),e._disposables=new m,k.each(u,function(a){return f._disposables.add(j.commands.registerCommand("quokka."+a,function(b){return f[a](b)}))}),j.commands.executeCommand("setContext","quokka.isLiveShareClient",!1),e._coverageDecorationTypes={1:f._createCoverageDecorationType("notCovered"),2:f._createCoverageDecorationType("covered"),3:f._createCoverageDecorationType("partiallyCovered"),4:f._createCoverageDecorationType("errorSource"),5:f._createCoverageDecorationType("errorPath")},e._hideAfterContentDecorationType=p.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 -10000px"}}),e._debugOutputChannel={appendLine:function(a,b){console.log("%c "+a,"color: "+("error"===b?"red":"darkgreen"))}},e._activeSessions=[],e._setupEnvironment(),e._setupLiveSharing(c,d),e}return d(b,a),b.prototype._setupLiveSharing=function(a,b){return e(this,void 0,void 0,function(){var c,d,g,h,i,l,n=this;return f(this,function(o){switch(o.label){case 0:return a?[3,1]:(this._debugOutputChannel.appendLine("Quokka.js Live Share integration disabled, VSLS not found."),[2]);case 1:return this._liveShare={api:a},c=this._liveShare,[4,a.shareService(b)];case 2:return c.server=o.sent(),d=this._liveShare,[4,a.getSharedService(b)];case 3:if(d.client=o.sent(),!this._liveShare.server||!this._liveShare.client)return this._debugOutputChannel.appendLine('Could not create a shared service. You have to set "liveshare.features" to "experimental" in your user settings in order to use live sharing.'),delete this._liveShare,[2];o.label=4;case 4:return g=function(){return k.uniq(n._activeSessions.filter(function(a){return p.visibleTextEditors.find(function(b){return b.document===a.textDocument})}).map(function(a){return{file:a.liveShareFileName,originalFile:a.textDocument.uri,fileName:a.fileName,documentUpdates:a.documentUpdates,stats:a.stats,mode:a.mode,headerData:a.headerData,outputChannelName:a.outputChannelName}}))},h=function(a){var b=n._liveShare.activeServerSessions.find(function(b){return 0===a.document.uri.scheme.localeCompare(b.file.scheme)&&0===a.document.uri.path.localeCompare(b.file.path)});if(b){n._start(a.document,a,b.mode,b.outputChannelName);var c=l(b.file);n.processStarted(c),c.output.setHeaderData(b.headerData),c.headerData=b.headerData,b.documentUpdates[b.file.path]=b.documentUpdates[b.fileName],delete b.documentUpdates[b.fileName],n._updateDocuments(c,b.documentUpdates),n.processStats(c,b.stats),n._liveShare.activeServerSessions=n._liveShare.activeServerSessions.filter(function(a){return a!=b})}},this._liveShare.api.onDidChangePeers(function(a){return e(n,void 0,void 0,function(){return f(this,function(b){return this._liveShareServerActive()&&a.added.length&&(this._liveShare.serverAllowed||this._activeSessions.length&&(p.showWarningMessage("You have not given permission to run Quokka.js in your Live Share Session. All Quokka.js instances have been stopped."),this.stopAll())),[2]})})}),this._context.subscriptions.push(this._liveShare.server.onDidChangeIsServiceAvailable(function(a){return e(n,void 0,void 0,function(){var b=this;return f(this,function(c){return a?(this._activeSessions.forEach(function(a){a.liveShareFileName=b._liveShare.api.convertLocalUriToShared(a.textDocument.uri)}),this._liveShare.disposable=new m,this._liveShare.disposable.add(function(){return delete b._liveShare.serverAllowed}),this._liveShare.disposable.add(p.onDidChangeActiveTextEditor(function(a){b._liveShare.server.notify("visibleEditorFilesChanged",{activeServerSessions:g()})})),this._liveShare.serverAllowed=!1,this._activeSessions.length&&this._showLiveShareWarningMessage()):(this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable),[2]})})})),this._context.subscriptions.push(this._liveShare.client.onDidChangeIsServiceAvailable(function(a){return e(n,void 0,void 0,function(){var b,c=this;return f(this,function(d){switch(d.label){case 0:return a?(j.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),this._liveShare.disposable=new m,this._liveShare.disposable.add(function(){return delete c._liveShare.activeServerSessions}),this._liveShare.disposable.add(p.onDidChangeActiveTextEditor(function(a){return h(a)})),b=this._liveShare,[4,this._liveShare.client.request("init",[])]):[3,2];case 1:return b.activeServerSessions=d.sent(),[3,3];case 2:j.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable,d.label=3;case 3:return[2]}})})})),i=function(a){return p.visibleTextEditors.find(function(b){return 0===b.document.uri.scheme.localeCompare(a.scheme)&&0===b.document.uri.path.localeCompare(a.path)})},l=function(a){return n._activeSessions.find(function(b){return b.fileName===a.path})},this._liveShare.server.onRequest("init",function(){return g()}),this._liveShare.client.onNotify("visibleEditorFilesChanged",function(a){n._liveShare.activeServerSessions=a.activeServerSessions;var b=n._liveShare.activeServerSessions.map(function(a){return l(a.file)}).filter(function(a){return!!a});n._activeSessions.filter(function(a){return!b.find(function(b){return a===b})}).forEach(function(a){n._stop(a),n._hideStatusIndicator()}),n._liveShare.activeServerSessions=n._liveShare.activeServerSessions.filter(function(a){return!l(a.file)})}),this._liveShare.client.onNotify("busy",function(a){var b=l(a.file);b&&n.processSessionBusy(b)}),this._liveShare.client.onNotify("stopped",function(a){var b=n._liveShare.activeServerSessions.find(function(b){return 0===a.file.uri.scheme.localeCompare(b.file.scheme)&&0===a.file.uri.path.localeCompare(b.file.path)});b&&n._liveShare.activeServerSessions.filter(function(a){return a!=b});var c=l(a.file);c&&(n._stop(c),n._hideStatusIndicator())}),this._liveShare.client.onNotify("started",function(a){var b=i(a.file);if(!b){var c=n._liveShare.activeServerSessions.find(function(b){return 0===a.file.uri.scheme.localeCompare(b.file.scheme)&&0===a.file.uri.path.localeCompare(b.file.path)});return void(c||n._liveShare.activeServerSessions.push({file:a.file,originalFile:a.originalFile,fileName:a.fileName,documentUpdates:{},stats:void 0,mode:a.data.mode,headerData:null,outputChannelName:a.data.outputChannelName}))}n._start(b.document,b,a.data.mode,a.data.outputChannelName);var d=l(a.file);n.processStarted(d)}),this._liveShare.client.onNotify("stats",function(a){var b=n._liveShare.activeServerSessions.find(function(b){return 0===a.file.scheme.localeCompare(b.file.scheme)&&0===a.file.path.localeCompare(b.file.path)});b&&(b.stats=a.data);var c=l(a.file);c&&n.processStats(c,a.data)}),this._liveShare.client.onNotify("documentUpdates",function(a){var b=n._liveShare.activeServerSessions.find(function(b){return 0===a.file.scheme.localeCompare(b.file.scheme)&&0===a.file.path.localeCompare(b.file.path)});b&&(b.documentUpdates=a.data);var c=l(a.file);c&&(a.data[a.file.path]=a.data[a.fileName],delete a.data[a.fileName],n._updateDocuments(c,a.data))}),this._liveShare.client.onNotify("consoleOutput",function(a){var b=l(a.file);b&&n._displayLiveConsoleOutput(b,a.data)}),this._liveShare.client.onNotify("configChanged",function(a){var b=n._liveShare.activeServerSessions.find(function(b){return 0===a.file.scheme.localeCompare(b.file.scheme)&&0===a.file.path.localeCompare(b.file.path)});b&&(b.headerData=a.data);var c=l(a.file);c&&(c.output.setHeaderData(a.data),c.headerData=a.data)}),[2]}})})},b.prototype._setupEnvironment=function(){var a=this;this._quokkaFolder=g.join(i.homedir(),".quokka"),this._lkp=g.join(this._quokkaFolder,".qlc");try{h.existsSync(this._quokkaFolder)||h.mkdirSync(this._quokkaFolder)}catch(a){}var b=this._loadQuokkaConfig();this._pro=b.pro===!0,b.pro!==!0&&b.pro!==!1&&(p.showInformationMessage("Would you like to try 'Pro' edition features or to only use the 'Community' edition features?",{title:"'Pro' features as well",pro:!0},{title:"'Community' features only",pro:!1}).then(function(c){c&&(b.pro=c.pro,a._saveQuokkaConfig(b))}),p.showInformationMessage("You are using Quokka.js 'Community' edition (free). Quokka.js 'Pro' edition with some advanced features is also available.",{title:"More info",url:j.Uri.parse("https://quokkajs.com/pro")}).then(function(a){a&&a.url&&j.commands.executeCommand("vscode.open",a.url)}))},b.prototype._quokkaConfigPath=function(){return g.join(this._quokkaFolder,"config.json")},b.prototype._loadQuokkaConfig=function(){var a,b=this._quokkaConfigPath(),c={};try{a=h.readFileSync(b).toString(),c=JSON.parse(a)}catch(b){a&&p.showWarningMessage("Looks like your quokka config.json file has invalid syntax, it should be a valid JSON file.")}return c},b.prototype._saveQuokkaConfig=function(a){h.writeFileSync(this._quokkaConfigPath(),JSON.stringify(a))},b.prototype._createCoverageDecorationType=function(a){return p.createTextEditorDecorationType({isWholeLine:!0,gutterIconPath:this._context.asAbsolutePath(g.join("images",a+".svg")).split("\\").join("/"),light:{after:{color:"errorSource"===a?"#c80000":"#0000ff"}},dark:{after:{color:"errorSource"===a?"#fe536a":"rgba(86, 156, 214, 1)"}}})},b.prototype.addImport=function(a){p.activeTextEditor&&b._addCode(p.activeTextEditor,"import "+a+" from '"+a+"';\n")},b.prototype.addRequire=function(a){p.activeTextEditor&&b._addCode(p.activeTextEditor,"const "+a+" = require('"+a+"');\n")},b._addCode=function(a,b){var c=new j.WorkspaceEdit;c.insert(a.document.uri,new j.Position(0,0),b),j.workspace.applyEdit(c)},b.prototype.createFile=function(){var a=this;p.showQuickPick(["JavaScript","TypeScript"]).then(function(b){return a._createLanguageFile(b)})},b.prototype.showOutput=function(){this._activeSession&&this._activeSession.outputChannel&&this._activeSession.outputChannel.show(!0)},b.prototype.createJavaScriptFile=function(){this._createLanguageFile("JavaScript")},b.prototype.createTypeScriptFile=function(){this._createLanguageFile("TypeScript")},b.prototype.makeQuokkaFromExistingFile=function(){var a=this;this._runIfAllowed(function(){return a._runFromExistingFile(w.automatic)})},b.prototype.runOnSave=function(){var a=this;return this._pro?void this._runIfAllowed(function(){return a._runFromExistingFile(w.onsave)}):void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},b.prototype.runOnce=function(){var a=this;return this._pro?void this._runIfAllowed(function(){var b=p.activeTextEditor;if(b){var c=b.document;if(c){var d=a._activeSessions.find(function(a){return a.textDocument===c});d&&d.mode===w.once?d.changes.length?a._processDocumentContentChange(d,c,[],!0):d.runTests({file:d.fileName}):a._runFromExistingFile(w.once)}}}):void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},b.prototype.stopCurrent=function(){var a=p.activeTextEditor,b=a&&a.document&&this._activeSessions.find(function(b){return b.textDocument===a.document})||this._activeSession;b&&this._stop(b)},b.prototype.stopAll=function(){var a=this;this._activeSessions.slice().forEach(function(b){return a._stop(b)})},b.prototype.showInstrumentedFile=function(){var a=this;this._activeSession&&this._activeSession.requestInstrumentedFile({path:this._activeSession.fileName},function(b){a._activeSession.output.clearAndRenderHeader(),a._activeSession.output.appendConsoleMessage({text:b,type:"warn"})})},b.prototype.installMissingPackageToProject=function(){this._installPackage(!0)},b.prototype.installMissingPackageToQuokka=function(){this._installPackage()},b.prototype.installQuokkaPlugin=function(a){this._installPackage(!1,a)},b.prototype.showValue=function(){var a=p.activeTextEditor;if(a){var b=this._activeSession;if(b&&b.textDocument&&a.document===b.textDocument){var c=a.selection;if(c&&c.end){var d=b.textDocument.offsetAt(c.end),e=b.textDocument.getText();b.fileChangedInEditor(b.fileName,e.substring(0,d)+"/*?*/"+e.substr(d),void 0,!0)}}}},b.prototype.goToLineInQuokkaFile=function(a){if(this._activeSession){if(!a)return void p.showTextDocument(this._activeSession.textDocument);a=a.split(",");var b=a[0]-1,c=(a[1]||1)-1;p.showTextDocument(this._activeSession.textDocument).then(function(a){var d=new j.Position(b,c);a.revealRange(new j.Range(d,d)),a.selection=new j.Selection(d,d)})}},b.prototype._installPackage=function(a,b){if(!this._activeSession)return void p.showWarningMessage("Cannot install a package because quokka is not running.");if(b)this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:b,plugin:{editConfig:!0}}});else{if(a&&!this._projectRoot())return void p.showWarningMessage("Cannot install a package into project because quokka is running outside of an opened project.");if(!this._pro)return void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession);if(!this._activeSession.stats||!this._activeSession.stats.errors)return void p.showWarningMessage("No missing packages to install.");var c=k.find(this._activeSession.stats.errors,function(a){return a.missingPackage});if(!c||!c.missingPackage)return void p.showWarningMessage("No missing packages to install.");this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:c.missingPackage,local:a}})}},b.prototype._setupVersionSpecificComponents=function(a){var b=a.major,c=a.minor;b>=1&&c>=11&&(this._outputDocumentSelector.scheme="*"),b>=1&&c>=16&&(this._multiFolderWorkspaces=!0)},b.prototype._createLanguageFile=function(a){var b=this;return a&&o.openTextDocument({language:a.toLowerCase()}).then(function(a){return p.showTextDocument(a).then(function(c){return b._start(a,c,w.automatic)})})},b.prototype._stop=function(a){a.disposable&&a.disposable.dispose(),this._activeSessions.splice(this._activeSessions.findIndex(function(b){return b===a}),1),this._hideStatusIndicator()},b.prototype._hideStatusIndicator=function(){this._statusBar.stopProgress(),this._statusBar.hide()},b.prototype._relativeNormalizedFilePath=function(a){return this._utils.normalizePath(g.relative(this._projectRoot(),a))},b.prototype._runFromExistingFile=function(a){var b=p.activeTextEditor;if(b){var c=b.document;if(c){var d=this._activeSessions.find(function(a){return a.textDocument===c});d&&this._stop(d);var e=v[c.languageId];return e?void this._start(c,b,a):void p.showWarningMessage('Language "'+c.languageId+'" is not supported')}}},b.prototype._runIfAllowed=function(a){return this._liveShareServerActive()&&!this._liveShare.serverAllowed?void this._showLiveShareWarningMessage(a):void a()},b.prototype._showLiveShareWarningMessage=function(a){var b=this;p.showWarningMessage("When sharing outside read-only mode, the Quokka.js extension will execute CODE WRITTEN BY OTHERS ON YOUR COMPUTER. Select 'Allow' to continue executing Quokka.js during your Live Share Session.",{title:"Allow",allow:!0},{title:"Deny",allow:!1}).then(function(c){b._liveShare.serverAllowed=!(!c||!c.allow),b._liveShare.serverAllowed?a&&a():b._activeSessions.length&&(p.showInformationMessage("All Quokka.js instances have been stopped."),b.stopAll())})},b.prototype._liveShareClientActive=function(){return!!(this._liveShare&&this._liveShare.client&&this._liveShare.client.isServiceAvailable)},b.prototype._liveShareServerActive=function(){return!!(this._liveShare&&this._liveShare.server&&this._liveShare.server.isServiceAvailable)},b.prototype._sendToLiveShareClients=function(a,b,c){this._liveShareServerActive()&&this._liveShare.server.notify(a,{file:b.liveShareFileName,originalFile:b.textDocument.uri,fileName:b.fileName,data:c})},b.prototype._start=function(a,c,d,e){var f=this;this._updateConfigurationFromSettings(),b._checkConfigurationSettings();var h=this._liveShareClientActive(),i=h?{}:new this._Session;h&&(i.isDisposed=function(){return!1},i.stop=function(){});var l=new m;if(l.add(function(){f._sendToLiveShareClients("stopped",i)}),this._watcher||h||(this._watcher=o.createFileSystemWatcher("**/*.*"),this._disposables.add(this._watcher)),h||(l.add(j.languages.registerHoverProvider(a.languageId,{provideHover:function(b,c){if(b===a&&!k.isEmpty(i.errorDataByLine)){var d=(i.errorDataByLine[c.line]||{}).hover;if(d)return new j.Hover(d.value)}}})),l.add(j.languages.registerCodeActionsProvider(a.languageId,{provideCodeActions:function(b,c){if(b===a&&!k.isEmpty(i.errorDataByLine)){var d=(i.errorDataByLine[c.start.line]||{}).commands;if(d)return d}}}))),d===w.automatic&&!h){var q=function(){i.runTests({file:i.fileName,externalFileChange:!0})};l.add(this._watcher.onDidCreate(q)),l.add(this._watcher.onDidChange(q)),l.add(this._watcher.onDidDelete(q))}if(i.mode=d,i.disposable=l,i.textDocument=a,i.id=++t,i.changes=[],i.fileName=s+v[a.languageId],"file"===a.uri.scheme&&this._projectRoot(a.uri.fsPath)){var r=this._relativeNormalizedFilePath(a.uri.fsPath);r&&(i.fileName=r,this._liveShareServerActive()&&(i.liveShareFileName=this._liveShare.api.convertLocalUriToShared(a.uri)))}"vsls"===a.uri.scheme&&h&&(i.fileName=a.uri.path),i.editors=[c],i.liveConsoleOutput=[],this._activeSessions.push(i),l.add(o.onDidCloseTextDocument(function(b){a===b&&f._stop(i)})),l.add(o.onDidChangeTextDocument(function(b){a===b.document&&(i.mode===w.automatic?f._processDocumentContentChange(i,b.document,b.contentChanges,!0):(f._hideStatusIndicator(),f._clearDecorations(i),f._processDocumentContentChange(i,b.document,b.contentChanges,!1)))})),l.add(o.onDidSaveTextDocument(function(b){a===b&&f._processDocumentContentChange(i,b,[],!0)})),l.add(p.onDidChangeActiveTextEditor(function(b){var c=i.editors.length,d=i.editors.includes(b);i.editors=i.editors.filter(function(a){return p.visibleTextEditors.includes(a)});for(var e=0;e<c-i.editors.length;e++)h||i.fileClosedInEditor(i.fileName);p.visibleTextEditors.filter(function(b){return b.document===a}).forEach(function(a){i.editors.includes(a)||(i.editors.push(a),h?f._updateDocuments(i,i.documentUpdates):i.fileOpenedInEditor(i.fileName))}),d&&(h?f._updateDocuments(i,i.documentUpdates):(i.fileClosedInEditor(i.fileName),i.fileOpenedInEditor(i.fileName)))})),i.outputChannelName=e||"Quokka #"+this._activeSessions.length;var u=p.createOutputChannel(i.outputChannelName);i.outputChannel=u,u.append("");var x=k.bind(this._absoluteFilePath,this),y=new n(u,i.fileName,x,this._state.coreClient.dmp,i.disposable,this._outputDocumentSelector,!!this._projectRoot(),this._liveShareClientActive());this._colorizeOutput?y.useMarkup():y.disableMarkup(),i.output=y,h||(i.start({localRoot:this._projectRoot(),quokkaFolder:this._quokkaFolder,client:"VSCode",cv:j.version,fileName:i.fileName,editorTypeScript:g.join(process.mainModule.filename,"../../extensions/node_modules/typescript")}),i.on("notification",function(a){return f._showNotification(a,i)}),i.on("busy",function(){f._sendToLiveShareClients("busy",i),f.processSessionBusy(i)}),i.on("stopped",function(a){f._sendToLiveShareClients("stopped",i),f._stop(i),f._hideStatusIndicator(),a.deactivate&&(f.stopAll(),f._forceDeactivate())}),i.on("started",function(){f._sendToLiveShareClients("started",i,{mode:i.mode,outputChannelName:i.outputChannelName}),f.processStarted(i)}),i.on("stats",function(a){f._sendToLiveShareClients("stats",i,a),f.processStats(i,a)}),i.on("live",function(a){i.fileChangedInEditor(i.fileName,i.textDocument.getText()),i.fileOpenedInEditor(i.fileName)}),i.on("configChanged",function(a){f._pro=a&&a.pro,y.setHeaderData(a),i.headerData=a,f._sendToLiveShareClients("configChanged",i,a)}),i.on("documentUpdates",function(a){f._updateDocuments(i,a),f._sendToLiveShareClients("documentUpdates",i,a)}),i.on("consoleError",function(a){a&&a.split("\n").forEach(function(a){return a&&f._debugOutputChannel.appendLine("[Error] #"+i.id+" "+a,"error")}),i.emit("stats",a)}),i.on("consoleLog",function(a){a&&a.split("\n").forEach(function(a){return a&&f._debugOutputChannel.appendLine("[Info]  #"+i.id+" "+a)})}),i.on("consoleOutput",function(a){f._sendToLiveShareClients("consoleOutput",i,a),f._displayLiveConsoleOutput(i,a)})),this._updateStatus(i,"progress"),l.add(function(){i.output.dispose(),u.hide(),u.dispose(),i.stop(),f._clearDecorations(i),delete i.editors,delete i.disposable,delete i.outputChannel,delete i.output,i===f._activeSession&&delete f._activeSession,b._clearIdleSessionTimeout(i),f._debugOutputChannel.appendLine("[Info]  #"+i.id+" Quokka.js stopped")})},b.prototype.processStats=function(a,c){c&&(b._outputResults(a.output,c),a.stats=c,this._processErrors(a)),this._updateStatus(a),delete a.liveConsoleOutput,b._sessionIsActive(a)},b.prototype.processStarted=function(a){this._debugOutputChannel.appendLine("[Info]  #"+a.id+" Quokka.js started");var b=j.workspace.getConfiguration().get("quokka.showOutputOnStart",!0);b&&a.outputChannel&&a.outputChannel.show(!0),p.showTextDocument(a.textDocument,a.editors&&(a.editors.length||void 0)&&a.editors[0]&&a.editors[0].viewColumn)},b.prototype.processSessionBusy=function(a){var b=this;clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){return b._updateStatus(a,"progress")},q),a.liveConsoleOutput=[],this._scheduleSessionIdleTimeout(a)},b.prototype._forceDeactivate=function(){this._deactivator(),k.each(u,function(a){return j.commands.registerCommand("quokka."+a,function(){return p.showWarningMessage("Please restart VS Code for a new trial session of Quokka.js 'Pro'.")})})},b.prototype._showNotification=function(a,b){var c=this,d=[];if(!~a.text.indexOf("expire")||"warning"!==a.type||!this._suppressExpirationNotifications){var e=function(a){return a&&a.url&&j.commands.executeCommand("vscode.open",a.url)};if(a.invalidVersion){a.text="You are not licensed to use Quokka PRO features for this version of VS Code. As your 12 months of free Quokka updates have expired, this is likely a result of VS Code updating itself OR that your Quokka extension has automatically updated.",d.push({title:"Renew",url:j.Uri.parse("https://quokkajs.com/pro"),command:e}),d.push({title:"Activate",command:"quokka.showLicense"}),d.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"});var f=new Date(a.expiryDate),g="https://quokkajs.com/docs/previous.html?expirydate="+f.getFullYear()+"-"+f.getMonth()+"-"+f.getDate();a.compatibleEditorVersion&&(g=g+"&editortype=VSCode&editor="+encodeURIComponent("VS Code version "+a.compatibleEditorVersion),a.text=a.text+" The last version of VS Code compatible with your license is "+a.compatibleEditorVersion+"."),d.push({title:"Help / Downgrade",url:j.Uri.parse(g),command:e})}else if(a.expiringSoon){var f=new Date(a.expiryDate);a.text="Your Quokka license free upgrades period expires on "+f.toLocaleDateString()+". If you would like to work with the latest version of Quokka and future versions released within the next 12 months, please visit our website to upgrade your license.",d.push({title:"Renew",url:j.Uri.parse("https://quokkajs.com/pro"),command:e
}),d.push({title:"Activate",command:"quokka.showLicense"});var g="https://quokkajs.com/docs/previous.html?expirydate="+f.getFullYear()+"-"+f.getMonth()+"-"+f.getDate();d.push({title:"Help",url:j.Uri.parse(g),command:e})}else a.suggestProEdition?(d.push({title:"Switch to 'Pro'",command:function(){return c._switchEdition(!0,b)}}),d.push({title:"More info",url:j.Uri.parse("https://quokkajs.com/pro"),command:e})):(~a.text.indexOf("continue-trial-link")&&d.push({title:"Continue Trial",command:function(){return b&&!b.isDisposed()&&b.continueTrial()}}),~a.text.indexOf("activate-link")&&d.push({title:"Activate License",command:"quokka.showLicense"}),~a.text.indexOf("purchase")&&(d.push({title:"Purchase",url:j.Uri.parse("https://quokkajs.com/pro"),command:e}),d.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"})));a.text=a.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");var h=[a.text].concat(d);p["show"+a.type.charAt(0).toUpperCase()+a.type.substr(1)+("info"===a.type?"rmation":"")+"Message"].apply(p,h).then(this._executeCommand),0===a.text.indexOf("Can not start node.js process")&&p.showInformationMessage('You may use the "node" setting to configure the location of node.',{title:"More info",url:j.Uri.parse("https://quokkajs.com/docs/configuration.html#nodejs-version")}).then(function(a){a&&a.url&&j.commands.executeCommand("vscode.open",a.url)})}},b.prototype.showLicense=function(){var a=this,b="";try{b=h.readFileSync(this._lkp).toString()}catch(a){}p.showInputBox({value:b.length>100?b:"",prompt:"Enter your Quokka.js 'Pro' license key"}).then(function(c){if(!k.isUndefined(c)){var d=b,e=c||"",f=!!a._parseLicenseKey(d),g=a._parseLicenseKey(e),i=!!g,j=!1;if(i||!e&&f)try{h.writeFileSync(a._lkp,e),j=i}catch(a){p.showErrorMessage("Unable to save license key: "+a.message),j=!1}else p.showWarningMessage("The entered license key is not a valid Quokka.js 'Pro' license key.");j&&(p.showInformationMessage("Quokka.js 'Pro' is licensed to: "+g.licensee+". Free upgrades until: "+g.expiration+"."),a.switchToPro())}})},b.prototype._parseLicenseKey=function(a){if(k.isString(a))try{var b=this._utils.parseKey(a);if(b.licenseeName&&b.expirationDateString&&~b.licensedProduct.indexOf("Quokka"))return{licensee:b.licenseeName,expiration:b.expirationDateStringFormatted||b.expirationDateString}}catch(a){return}},b.prototype.switchToCommunity=function(){this._switchEdition(!1,this._activeSession)},b.prototype.switchToPro=function(){this._switchEdition(!0,this._activeSession)},b.prototype._switchEdition=function(a,b){var c=this._loadQuokkaConfig();if(c.pro=a,this._pro=a,this._saveQuokkaConfig(c),!this._liveShareClientActive()&&b&&!b.isDisposed()){var d=b.textDocument,e=b.editors[0];this.stopAll(),b.mode!=w.automatic&&b.mode!==w.onsave||this._start(d,e,b.mode)}},b.prototype._processErrors=function(a){var c=this;this._liveShareClientActive()||a.stats.errors&&(a.errorDataByLine={},b._addLineData(a,b._createLineDataObject(a,function(a){return a.missingPackage},function(a){return[{title:'Install "'+a.missingPackage+'" package for the current quokka file',command:"installMissingPackageToQuokka"},c._projectRoot()&&{title:'Install "'+a.missingPackage+'" package into the project',command:"installMissingPackageToProject"}]})),b._addLineData(a,b._createLineDataObject(a,function(a){return a.missingBrowserGlobal},function(a){return[{title:'"'+a.missingBrowserGlobal+'" looks like a browser global'},{title:"Install and use quokka browser plugin",command:"installQuokkaPlugin",arg:"jsdom-quokka-plugin"}]})),b._addLineData(a,b._createLineDataObject(a,function(a){return a.undefinedName},function(a){return[{title:'Add "import '+a.undefinedName+" from '"+a.undefinedName+"';\"",command:"addImport",arg:a.undefinedName},{title:'Add "const '+a.undefinedName+" = require('"+a.undefinedName+"');\"",command:"addRequire",arg:a.undefinedName}]})))},b._addLineData=function(a,b){b&&(a.errorDataByLine[b.line]=b)},b._createHoverObject=function(a){return a.filter(function(a){return!!a}).map(function(a){return a.command?"\n["+a.title+"]("+encodeURI("command:quokka."+a.command+(a.arg?"?"+JSON.stringify(a.arg):""))+")":a.title}).join("\n")},b._createCommands=function(a){return a.filter(function(a){return a&&a.command}).map(function(a){return{title:a.title,command:"quokka."+a.command,arguments:a.arg?[a.arg]:void 0}})},b._createLineDataObject=function(a,c,d){var e=a.stats.errors.find(c),f=e&&e.stack||[];if(f.reverse(),f.length){var g=k.find(f,function(b){return b.file===a.fileName});if(g&&g.loc&&g.loc.split){var h=d(e),i=b._createHoverObject(h);return j.MarkdownString&&(i=new j.MarkdownString(i),i.isTrusted=!0),{line:parseInt(g.loc.split(":")[0],10)-1,hover:{value:i},commands:b._createCommands(h)}}}},b._checkConfigurationSettings=function(){try{var a=j.workspace.getConfiguration();a&&!a.get("editor.glyphMargin",!0)&&p.showWarningMessage("Quokka.js will not display coverage indicators in the gutter because the `editor.glyphMargin` setting is set to `false`.")}catch(a){}},b.prototype._updateConfigurationFromSettings=function(){var a="",b=!1;try{var c=this._loadQuokkaConfig();a=c.node,c.useWsl&&(b=c.useWsl)}catch(a){}try{process.env.WALLABY_USE_WSL=b;var d=j.workspace.getConfiguration();if(d){this._suppressExpirationNotifications=d.get("quokka.suppressExpirationNotifications",!1),this._colorizeOutput=d.get("quokka.colorizeOutput",!0);var e=d.get("quokka.node",a);e?process.env.WALLABY_NODE=e:delete process.env.WALLABY_NODE}}catch(a){}},b.prototype.activate=function(){var a=this;this._onceDocumentStopsChanging=k.debounce(k.bind(this._onceDocumentStopsChanging,this),100),b._outputResults=k.debounce(k.bind(b._outputResults,this),100),this._statusBar.updateText=k.debounce(k.bind(this._statusBar.updateText,this._statusBar),200),this._executeCommand=k.bind(this._execute,this),this._statusBar.command="quokka.showOutput",this._disposables.add(function(){a._statusBar&&a._statusBar.hide(),a._activeSessions.forEach(function(a){return a.disposable.dispose()}),a._activeSessions.length=0})},b.prototype._projectRoot=function(a){var b=this;if(a&&this._multiFolderWorkspaces&&o.workspaceFolders&&o.workspaceFolders.length){var c=k.find(o.workspaceFolders,function(b){return~a.indexOf(b.uri.fsPath+g.sep)});if(c)return this._currectProjectRoot=c.uri.fsPath,this._currectProjectRoot}if(this._currectProjectRoot)if(this._multiFolderWorkspaces&&o.workspaceFolders){var c=k.find(o.workspaceFolders,function(a){return b._currectProjectRoot===a.uri.fsPath});if(c)return c.uri.fsPath}else if(o.rootPath&&this._currectProjectRoot===o.rootPath)return o.rootPath;return this._multiFolderWorkspaces&&o.workspaceFolders?o.workspaceFolders.length?o.workspaceFolders[0].uri.fsPath:void 0:o.rootPath||""},b.prototype.selectWorkspaceFolder=function(){var a=this;this._multiFolderWorkspaces&&o.workspaceFolders&&o.workspaceFolders.length>1&&p.showWorkspaceFolderPick&&p.showWorkspaceFolderPick().then(function(b){b&&(a._currectProjectRoot=b.uri.fsPath)})},b.prototype.deactivate=function(){this._disposables.dispose()},b._sessionIsActive=function(a){b._clearIdleSessionTimeout(a)},b.prototype._sessionIsIdle=function(a){this._clearDecorations(a),delete a.stats,a.liveConsoleOutput&&!a.liveConsoleOutput.started&&a.output.clearAndRenderHeader()},b._clearIdleSessionTimeout=function(a){a.idleTimeout&&(clearTimeout(a.idleTimeout),delete a.idleTimeout)},b.prototype._clearDecorations=function(a){var b=this;a.editors.forEach(function(a){k.each(b._coverageDecorationTypes,function(b){return a.setDecorations(b,[])}),a.setDecorations(b._hideAfterContentDecorationType,[])})},b.prototype._scheduleSessionIdleTimeout=function(a){var c=this;b._clearIdleSessionTimeout(a),a.idleTimeout=setTimeout(function(){return c._sessionIsIdle(a)},r)},b.prototype._displayLiveConsoleOutput=function(a,b){var c=this;if(a.liveConsoleOutput){var d=a.liveConsoleOutput.started;a.liveConsoleOutput=a.liveConsoleOutput.concat(b),a.liveConsoleOutput.started=d,a.liveConsoleOutput.started?a.displayLiveConsoleOutputTimeout||this._displayPendingLiveConsoleOutput(a):(a.liveConsoleOutput.started=!0,a.displayLiveConsoleOutputTimeout=setTimeout(function(){delete a.displayLiveConsoleOutputTimeout,a.liveConsoleOutput&&a.liveConsoleOutput.length&&(a.output.clearAndRenderHeader(),c._displayPendingLiveConsoleOutput(a))},150))}},b.prototype._displayPendingLiveConsoleOutput=function(a){a.liveConsoleOutput.forEach(function(b){return a.output.appendConsoleMessage(b)}),a.liveConsoleOutput.length=0},b.prototype._execute=function(a){if(a&&a.command)return"function"==typeof a.command?a.command(a):~a.command.indexOf("quokka.")?j.commands.executeCommand(a.command):this[a.command]()},b.prototype._processDocumentContentChange=function(a,b,c,d){a.isDisposed()||b&&b.uri&&b.uri.scheme&&"file"!==b.uri.scheme&&"untitled"!==b.uri.scheme&&"vsls"!==b.uri.scheme||(a.changes=a.changes.concat(c),this._hideMessagesForChangedRanges(a.changes),d&&this._onceDocumentStopsChanging(a,b))},b.prototype._onceDocumentStopsChanging=function(a,b){var c=this;!a.isDisposed()&&a.changes.length&&(this._liveShareClientActive()||(clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){return c._updateStatus(a,"progress")},q),a.fileChangedInEditor(a.fileName,b.getText(),{start:k.chain(a.changes).map(function(a){return a.range.start.line}).min().value()+1,end:k.chain(a.changes).map(function(a){return a.range.end.line}).max().value()+1}),a.changes=[]))},b.prototype._updateStatus=function(a,b){if(!a.isDisposed()){var c;clearTimeout(this._statusUpdateTimeout),b||(b=k.isString(a.stats)?"failing":a.stats?a.stats.errors.length?"failing":"passing":"failing",c=a.stats&&a.stats.time),b&&("progress"===b?this._statusBar.displayProgress():(this._statusBar.stopProgress(),this._statusBar.setMainText(("failing"===b?"✗":"✔")+(c?" "+c+"ms":"")),this._statusBar.updateText()),this._statusBar.show()),this._activeSession=a}},b.prototype._updateStatusExtension=function(a){this._statusBar.setExtensionText(a),this._statusBar.updateText()},b.prototype._removeStatus=function(){this._statusBar.hide()},b.prototype._updateDocuments=function(a,b){var c=this;a.isDisposed()||(a.documentUpdates=b,k.each(p.visibleTextEditors,function(d){if(d.document===a.textDocument){var e=b[a.fileName];if(e&&e.lines){var f={1:[],2:[],3:[],4:[],5:[]};k.each(e.lines,function(a){var b={range:new j.Range(a.num-1,0,a.num-1,1e3)},c=a.log||a.err,d=a.longLog||c;d&&(b.hoverMessage=j.MarkdownString?new j.MarkdownString("```\n"+d+"\n```"):{value:d}),f[a.state].push(b),c&&(b.renderOptions={after:{contentText:"  "+c}})}),k.each(f,function(a,b){return d.setDecorations(c._coverageDecorationTypes[b],a)}),c._scheduleHiddenMessagesDisplay()}}}))},b.prototype._hideMessagesForChangedRanges=function(a){clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,p.activeTextEditor&&p.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,a.map(function(a){return{range:new j.Range(a.range.start.line,0,a.range.end.line,1e3)}}))},b.prototype._scheduleHiddenMessagesDisplay=function(){var a=this;clearTimeout(this._displayHiddenMessagesTimeout);var b=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(function(){try{k.each(p.visibleTextEditors,function(b){return b&&b.setDecorations(a._hideAfterContentDecorationType,[])})}catch(a){}},Math.max(0,500-b))},b.prototype._navigate=function(a,b){if(a){var c,d,e=this._absoluteFilePath(a);k.isNumber(b)?c=b:k.isArray(b)?(c=b[0],d=b[1]):k.isString(b)&&(b=b.split(":"),c=b[0]&&parseInt(b[0],10),d=b[1]&&parseInt(b[1],10)),k.isNumber(c)?c-=1:c=0,k.isNumber(d)||(d=0),o.openTextDocument(e).then(function(a){return p.showTextDocument(a)}).then(function(a){var b=new j.Position(c,d);a.revealRange(new j.Range(b,b)),a.selection=new j.Selection(b,b)})}},b.prototype._absoluteFilePath=function(a){return g.resolve(this._projectRoot(),a)},b._outputResults=function(a,b,c){var d,e=a.lines();a.build(b);var f=a.lines();if(d=c||f.length!==e.length,!d)for(var g=0,h=f.length;g<h;g++)if(a.areDifferent(f[g],e[g])){d=!0;break}d&&a.render()},b}(l);b.exports=x},{"./compositeDisposable":3,"./outputBuilder":5,fs:void 0,os:void 0,path:void 0,vscode:void 0}],5:[function(a,b,c){"use strict";var d=a("vscode"),e=global._,f={text:"",link:Array(2).join("​"),error:Array(3).join("​"),duration:Array(4).join("​"),suite:Array(5).join("​"),message:Array(6).join("​"),diffIns:Array(2).join("‌⁠"),diffDel:Array(2).join("‍"),tmpDiffInsOpen:"wsDiffIns",tmpDiffInsClose:"weDiffIns",tmpDiffDelOpen:"wsDiffDel",tmpDiffDelClose:"weDiffDel"},g=function(){function a(a,b,c,f,g,h,i,j){var k=this;this._lines=[],this._links=[],this._quokkaFileName=b,this._contentLimit=1048576,this._channel=a,this._absolutePathResolver=c,this._dmp=f,this._hasOpenedProject=i,this.render=e.debounce(e.bind(this.render,this),300),this._header=this._channel.name,this.isLiveShareClient=j,this.diposed=!1,this.useMarkup(),g.add(d.languages.registerDocumentLinkProvider(h,{provideDocumentLinks:function(a){var b=a.lineAt(0);return b&&b.text&&~b.text.indexOf(k._channel.name)?k._links:[]}}))}return a.prototype.useMarkup=function(){this._markupTokens=e.extend({},f)},a.prototype.disableMarkup=function(){this._markupTokens.text=this._markupTokens.link=this._markupTokens.error=this._markupTokens.duration=this._markupTokens.suite=this._markupTokens.message=""},a.prototype.dispose=function(){this.diposed=!0},a.prototype.build=function(a){var b=this;this._lines=[],this._links=[],this._appendLine("suite",0,this._header);var c=e.isString(a);c?this._appendLine("error",0,a):e.isObject(a)&&(e.each(a.errors,function(a){return b._outputError(a)}),e.each(a.messages,function(a){return b._outputMessage(a)}))},a.prototype.lines=function(){return this._lines},a.prototype.render=function(){this._doRender()},a.prototype._doRender=function(a){if(!this.diposed){a=a||0,!a&&this._channel.clear();for(var b="",c=a,d=this._lines.length;c<d;c++){var e=this._lines[c];if(b+=e+"\n",b.length>this._contentLimit){b+="\n--- output truncated to "+this._contentLimit+" bytes ---\n";break}}this._channel.append(b)}},a.prototype.clearAndRenderHeader=function(){this._lines=[],this._links=[],this._appendLine("suite",0,this._header),this._doRender()},a.prototype.appendConsoleMessage=function(a){var b=this._lines.length;this._outputMessage(a),this._doRender(b)},a.prototype.show=function(){this.diposed||this._channel.show(!0)},a.prototype.areDifferent=function(a,b){return a!==b},a.prototype.setContentLimit=function(a){a&&(this._contentLimit=a)},a.prototype.setHeaderData=function(a){if(!this.diposed){var b=a.plugins||[];this._header=this._channel.name+(" (node: "+a.nodeVersion+(a.ts?", TypeScript: "+(a.ts.version&&"v"+a.ts.version||"unknown version"):"")+(a.babel?", babel: "+(a.babel.version&&"v"+a.babel.version||"unknown version"):"")+(b.length?", plugins: "+b.join(", "):"")+")")}},a.prototype._outputMessage=function(a){if("diff"===a.type){if(!a.context&&!a.actual&&!a.expected)return;a.text=a.context,delete a.context}a.context&&a.context.replace&&(a.context=a.context.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));var b=a.text&&(a.text.length>20||~a.text.indexOf("\n"))&&"diff"!==a.type,c="error"===a.type?"error":"warn"===a.type||"diff"===a.type?"duration":"message";if(b)this._appendLine(c,0,"\n"+a.text),this._outputLink(a,1);else{"diff"===a.type&&this._outputDiff(0,a.expected,a.actual);var d=a.text?"\n"+this._markupTokens[c]+a.text+this._markupTokens[c]:"";if(a.file){d+=" ";var e=this._markupTokens.link+a.file+(a.loc?":"+a.loc:"")+this._markupTokens.link;d+="at "+(a.context?this._markupTokens.duration+a.context+this._markupTokens.duration+" ":""),d+=e,this._addFileLink(a.file,a.loc,e,d.length-e.length,this._lines.length+1)}this._appendLine("text",0,d)}},a.prototype._outputError=function(a){var b=a.message,c=a.stack,d=a.expected,f=a.actual,g=a.missingPackage,h=a.missingBrowserGlobal,i=this,j=0;this._outputDiff(j,d,f),g&&!this.isLiveShareClient&&(this._addEmptyLine(),this._addCustomLinkLine('Install "'+g+'" package for the current quokka file',"command:quokka.installMissingPackageToQuokka",j),this._hasOpenedProject&&this._addCustomLinkLine('Install "'+g+'" package into the project',"command:quokka.installMissingPackageToProject",j)),h&&!this.isLiveShareClient&&(this._addEmptyLine(),this._appendLine("duration",j,'"'+h+'" looks like a browser global'),this._addCustomLinkLine("Install and use quokka browser plugin","command:quokka.installQuokkaPlugin?"+JSON.stringify("jsdom-quokka-plugin"),j),this._addCustomLinkLine("Open quokka browser plugin documentation","https://github.com/wallabyjs/jsdom-quokka-plugin",j)),this._appendLine("error",j,"\n"+b),e.each(c,function(a){return i._outputLink(a,j+1)})},a.prototype._outputDiff=function(a,b,c){var d=this;if(this._dmp&&(b||c)){var e="\n"+this._dmp.diff_prettyHtml(this._dmp.diff_wordMode(b||"",c||"")).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,this._markupTokens.tmpDiffInsOpen).replace(/<del[^>]*>/g,this._markupTokens.tmpDiffDelOpen).replace(/<\/ins[^>]*>/g,this._markupTokens.tmpDiffInsClose).replace(/<\/del[^>]*>/g,this._markupTokens.tmpDiffDelClose).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),f=0,g=0;this._appendLine("none",a,e,void 0,void 0,function(a){if(!a)return a;f>0&&(a=d._markupTokens.diffIns+a),g>0&&(a=d._markupTokens.diffDel+a);var b=(a.match(new RegExp(d._markupTokens.tmpDiffInsOpen,"g"))||[]).length,c=(a.match(new RegExp(d._markupTokens.tmpDiffInsClose,"g"))||[]).length;f+=b-c;var e=(a.match(new RegExp(d._markupTokens.tmpDiffDelOpen,"g"))||[]).length,h=(a.match(new RegExp(d._markupTokens.tmpDiffDelClose,"g"))||[]).length;return g+=e-h,f>0&&(a+=d._markupTokens.diffIns),g>0&&(a+=d._markupTokens.diffDel),a.replace(new RegExp(d._markupTokens.tmpDiffInsOpen,"g"),d._markupTokens.diffIns).replace(new RegExp(d._markupTokens.tmpDiffInsClose,"g"),d._markupTokens.diffIns).replace(new RegExp(d._markupTokens.tmpDiffDelOpen,"g"),d._markupTokens.diffDel).replace(new RegExp(d._markupTokens.tmpDiffDelClose,"g"),d._markupTokens.diffDel)})}},a.prototype._outputLink=function(a,b){var c=this;if(a.file){var d=a.file+(a.loc?":"+a.loc:"");this._appendLine("link",b,d,void 0,a.context,function(b,e){c._addFileLink(a.file,a.loc,d,e)})}},a.prototype._addCustomLinkLine=function(a,b,c){var e=this._lines.length;this._appendLine("text",c,this._markupTokens.link+a+this._markupTokens.link),this._links.push({range:new d.Range(e,this._markupTokens.link.length,e,a.length+this._markupTokens.link.length),target:d.Uri.parse(b)})},a.prototype._addFileLink=function(a,b,c,e,f){"."!==a[0]&&a!==this._quokkaFileName||(f=f||this._lines.length,this._links.push({range:new d.Range(f,e,f,e+c.length),target:0===a.indexOf("quokka")?d.Uri.parse("command:quokka.goToLineInQuokkaFile?"+JSON.stringify(this._location(b).substring(1))):d.Uri.parse(d.Uri.file(this._absolutePathResolver(a)).toString()+this._location(b))}))},a.prototype._location=function(a){var b,c;return e.isNumber(a)?b=a:e.isArray(a)?(b=a[0],c=a[1]):e.isString(a)&&(a=a.split(":"),b=a[0]&&parseInt(a[0],10),c=a[1]&&parseInt(a[1],10)),"#"+(e.isNumber(c)?b+","+(c+1):b)},a.prototype._addEmptyLine=function(){this._appendLine("text",0,"")},a.prototype._appendLine=function(a,b,c,d,f,g){var h=this,i=this,j=c.split("\n"),k=this._markupTokens[a]||"";e.each(j,function(c){var j=(d?"["+d+"] ":"")+e.pad("",2*b,"   ")+("link"===a?"at "+(f?h._markupTokens.duration+f+h._markupTokens.duration+" ":""):"")+k,l=j+c+k;if(g){var m=g(l,j.length);m&&(l=m)}i._lines.push(l)})},a}();b.exports=g},{vscode:void 0}]},{},[2]);